{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/lib/api.ts"],"sourcesContent":["import type {\n  RunInfo,\n  Transcript,\n  AssetIndex,\n  ShortEdit,\n  PipelineStage,\n} from \"./types\";\n\nconst BASE = \"/api\";\n\nasync function fetchJson<T>(url: string, init?: RequestInit): Promise<T> {\n  const res = await fetch(url, init);\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`${res.status}: ${text}`);\n  }\n  return res.json();\n}\n\n// Runs\nexport async function listRuns(): Promise<RunInfo[]> {\n  return fetchJson(`${BASE}/runs`);\n}\n\nexport async function getTranscript(runId: string): Promise<Transcript> {\n  return fetchJson(`${BASE}/runs/${runId}/transcript`);\n}\n\nexport async function getAssets(runId: string): Promise<AssetIndex> {\n  return fetchJson(`${BASE}/runs/${runId}/assets`);\n}\n\nexport async function getEdits(runId: string): Promise<ShortEdit[]> {\n  return fetchJson(`${BASE}/runs/${runId}/edits`);\n}\n\nexport async function saveEdits(\n  runId: string,\n  shorts: ShortEdit[]\n): Promise<void> {\n  await fetchJson(`${BASE}/runs/${runId}/edits`, {\n    method: \"PUT\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(shorts),\n  });\n}\n\n// Media URL builder\nexport function mediaUrl(relativePath: string): string {\n  return `${BASE}/media?path=${encodeURIComponent(relativePath)}`;\n}\n\n// Pipeline\nexport async function triggerPipeline(\n  stage: PipelineStage,\n  body: Record<string, unknown>\n): Promise<{ jobId: string }> {\n  return fetchJson(`${BASE}/pipeline/${stage}`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(body),\n  });\n}\n\nexport function pipelineStreamUrl(\n  stage: PipelineStage,\n  jobId: string\n): string {\n  return `${BASE}/pipeline/${stage}/stream?jobId=${jobId}`;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAQA,MAAM,OAAO;AAEb,eAAe,UAAa,GAAW,EAAE,IAAkB;IACzD,MAAM,MAAM,MAAM,MAAM,KAAK;IAC7B,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,AAAC,GAAiB,OAAf,IAAI,MAAM,EAAC,MAAS,OAAL;IACpC;IACA,OAAO,IAAI,IAAI;AACjB;AAGO,eAAe;IACpB,OAAO,UAAU,AAAC,GAAO,OAAL,MAAK;AAC3B;AAEO,eAAe,cAAc,KAAa;IAC/C,OAAO,UAAU,AAAC,GAAe,OAAb,MAAK,UAAc,OAAN,OAAM;AACzC;AAEO,eAAe,UAAU,KAAa;IAC3C,OAAO,UAAU,AAAC,GAAe,OAAb,MAAK,UAAc,OAAN,OAAM;AACzC;AAEO,eAAe,SAAS,KAAa;IAC1C,OAAO,UAAU,AAAC,GAAe,OAAb,MAAK,UAAc,OAAN,OAAM;AACzC;AAEO,eAAe,UACpB,KAAa,EACb,MAAmB;IAEnB,MAAM,UAAU,AAAC,GAAe,OAAb,MAAK,UAAc,OAAN,OAAM,WAAS;QAC7C,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;AACF;AAGO,SAAS,SAAS,YAAoB;IAC3C,OAAO,AAAC,GAAqB,OAAnB,MAAK,gBAA+C,OAAjC,mBAAmB;AAClD;AAGO,eAAe,gBACpB,KAAoB,EACpB,IAA6B;IAE7B,OAAO,UAAU,AAAC,GAAmB,OAAjB,MAAK,cAAkB,OAAN,QAAS;QAC5C,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;AACF;AAEO,SAAS,kBACd,KAAoB,EACpB,KAAa;IAEb,OAAO,AAAC,GAAmB,OAAjB,MAAK,cAAkC,OAAtB,OAAM,kBAAsB,OAAN;AACnD","debugId":null}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/lib/timeline-utils.ts"],"sourcesContent":["import type { KeepSegment, WordTimestamp } from \"./types\";\n\n/** Convert source time (in a-roll) to concatenated time (in rendered short) */\nexport function sourceToConcatTime(\n  sourceTime: number,\n  segments: KeepSegment[]\n): number | null {\n  let concatOffset = 0;\n  for (const seg of segments) {\n    if (sourceTime >= seg.start && sourceTime <= seg.end) {\n      return concatOffset + (sourceTime - seg.start);\n    }\n    concatOffset += seg.end - seg.start;\n  }\n  return null; // sourceTime is in a gap (removed content)\n}\n\n/** Convert concatenated time back to source time */\nexport function concatToSourceTime(\n  concatTime: number,\n  segments: KeepSegment[]\n): number {\n  let remaining = concatTime;\n  for (const seg of segments) {\n    const segDuration = seg.end - seg.start;\n    if (remaining <= segDuration) {\n      return seg.start + remaining;\n    }\n    remaining -= segDuration;\n  }\n  // Past end - return end of last segment\n  const last = segments[segments.length - 1];\n  return last ? last.end : 0;\n}\n\n/** Total duration of concatenated segments */\nexport function totalConcatDuration(segments: KeepSegment[]): number {\n  return segments.reduce((sum, seg) => sum + (seg.end - seg.start), 0);\n}\n\n/** Find which segment index contains a given source time, or -1 */\nexport function findSegmentAt(\n  sourceTime: number,\n  segments: KeepSegment[]\n): number {\n  return segments.findIndex(\n    (seg) => sourceTime >= seg.start && sourceTime <= seg.end\n  );\n}\n\n/** Convert pixel position to concat time */\nexport function pixelToTime(\n  x: number,\n  zoom: number,\n  scrollX: number\n): number {\n  return (x + scrollX) / zoom;\n}\n\n/** Convert concat time to pixel position */\nexport function timeToPixel(\n  time: number,\n  zoom: number,\n  scrollX: number\n): number {\n  return time * zoom - scrollX;\n}\n\n/** Format seconds as MM:SS.ms */\nexport function formatTime(seconds: number): string {\n  const mins = Math.floor(seconds / 60);\n  const secs = seconds % 60;\n  return `${mins}:${secs.toFixed(1).padStart(4, \"0\")}`;\n}\n\n/** Format seconds as MM:SS */\nexport function formatTimeShort(seconds: number): string {\n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n}\n\n/** Remap subtitle words from source time to concat time */\nexport function remapWordsToConcatTime(\n  words: WordTimestamp[],\n  segments: KeepSegment[]\n): WordTimestamp[] {\n  return words\n    .map((w) => {\n      const start = sourceToConcatTime(w.start, segments);\n      const end = sourceToConcatTime(w.end, segments);\n      if (start === null || end === null) return null;\n      return { ...w, start, end };\n    })\n    .filter((w): w is WordTimestamp => w !== null);\n}\n\n/** Get words that fall within given segments */\nexport function getWordsInSegments(\n  allWords: WordTimestamp[],\n  segments: KeepSegment[]\n): WordTimestamp[] {\n  return allWords.filter((w) =>\n    segments.some((seg) => w.start >= seg.start && w.end <= seg.end)\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAGO,SAAS,mBACd,UAAkB,EAClB,QAAuB;IAEvB,IAAI,eAAe;IACnB,KAAK,MAAM,OAAO,SAAU;QAC1B,IAAI,cAAc,IAAI,KAAK,IAAI,cAAc,IAAI,GAAG,EAAE;YACpD,OAAO,eAAe,CAAC,aAAa,IAAI,KAAK;QAC/C;QACA,gBAAgB,IAAI,GAAG,GAAG,IAAI,KAAK;IACrC;IACA,OAAO,MAAM,2CAA2C;AAC1D;AAGO,SAAS,mBACd,UAAkB,EAClB,QAAuB;IAEvB,IAAI,YAAY;IAChB,KAAK,MAAM,OAAO,SAAU;QAC1B,MAAM,cAAc,IAAI,GAAG,GAAG,IAAI,KAAK;QACvC,IAAI,aAAa,aAAa;YAC5B,OAAO,IAAI,KAAK,GAAG;QACrB;QACA,aAAa;IACf;IACA,wCAAwC;IACxC,MAAM,OAAO,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;IAC1C,OAAO,OAAO,KAAK,GAAG,GAAG;AAC3B;AAGO,SAAS,oBAAoB,QAAuB;IACzD,OAAO,SAAS,MAAM,CAAC,CAAC,KAAK,MAAQ,MAAM,CAAC,IAAI,GAAG,GAAG,IAAI,KAAK,GAAG;AACpE;AAGO,SAAS,cACd,UAAkB,EAClB,QAAuB;IAEvB,OAAO,SAAS,SAAS,CACvB,CAAC,MAAQ,cAAc,IAAI,KAAK,IAAI,cAAc,IAAI,GAAG;AAE7D;AAGO,SAAS,YACd,CAAS,EACT,IAAY,EACZ,OAAe;IAEf,OAAO,CAAC,IAAI,OAAO,IAAI;AACzB;AAGO,SAAS,YACd,IAAY,EACZ,IAAY,EACZ,OAAe;IAEf,OAAO,OAAO,OAAO;AACvB;AAGO,SAAS,WAAW,OAAe;IACxC,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;IAClC,MAAM,OAAO,UAAU;IACvB,OAAO,AAAC,GAAU,OAAR,MAAK,KAAoC,OAAjC,KAAK,OAAO,CAAC,GAAG,QAAQ,CAAC,GAAG;AAChD;AAGO,SAAS,gBAAgB,OAAe;IAC7C,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;IAClC,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;IAClC,OAAO,AAAC,GAAU,OAAR,MAAK,KAAoC,OAAjC,KAAK,QAAQ,GAAG,QAAQ,CAAC,GAAG;AAChD;AAGO,SAAS,uBACd,KAAsB,EACtB,QAAuB;IAEvB,OAAO,MACJ,GAAG,CAAC,CAAC;QACJ,MAAM,QAAQ,mBAAmB,EAAE,KAAK,EAAE;QAC1C,MAAM,MAAM,mBAAmB,EAAE,GAAG,EAAE;QACtC,IAAI,UAAU,QAAQ,QAAQ,MAAM,OAAO;QAC3C,OAAO;YAAE,GAAG,CAAC;YAAE;YAAO;QAAI;IAC5B,GACC,MAAM,CAAC,CAAC,IAA0B,MAAM;AAC7C;AAGO,SAAS,mBACd,QAAyB,EACzB,QAAuB;IAEvB,OAAO,SAAS,MAAM,CAAC,CAAC,IACtB,SAAS,IAAI,CAAC,CAAC,MAAQ,EAAE,KAAK,IAAI,IAAI,KAAK,IAAI,EAAE,GAAG,IAAI,IAAI,GAAG;AAEnE","debugId":null}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/lib/store.ts"],"sourcesContent":["\"use client\";\n\nimport { create } from \"zustand\";\nimport { temporal } from \"zundo\";\nimport type {\n  Transcript,\n  AssetIndex,\n  ShortEdit,\n  KeepSegment,\n  Overlay,\n  SFXCue,\n  PipelineStage,\n  StageStatus,\n  TimelineTool,\n  SelectedItem,\n  RunInfo,\n} from \"./types\";\nimport * as api from \"./api\";\nimport { totalConcatDuration, sourceToConcatTime } from \"./timeline-utils\";\n\nexport interface EditorState {\n  // Run\n  runs: RunInfo[];\n  currentRunId: string | null;\n\n  // Data\n  transcript: Transcript | null;\n  assets: AssetIndex | null;\n  shorts: ShortEdit[];\n\n  // Active short\n  activeShortId: number | null;\n\n  // Timeline\n  zoom: number; // pixels per second\n  scrollX: number;\n  cursorTime: number; // concat time\n  isPlaying: boolean;\n  activeTool: TimelineTool;\n  selectedItems: SelectedItem[];\n  duration: number; // total concat duration of active short\n\n  // Pipeline\n  pipelineStatus: Record<PipelineStage, StageStatus>;\n  pipelineLogs: string[];\n  activeJob: { stage: PipelineStage; jobId: string } | null;\n\n  // Dirty\n  isDirty: boolean;\n\n  // Actions\n  fetchRuns: () => Promise<void>;\n  loadRun: (runId: string) => Promise<void>;\n  selectShort: (shortId: number) => void;\n\n  // Timeline actions\n  setZoom: (zoom: number) => void;\n  setScrollX: (scrollX: number) => void;\n  setCursorTime: (time: number) => void;\n  setIsPlaying: (playing: boolean) => void;\n  togglePlay: () => void;\n  setActiveTool: (tool: TimelineTool) => void;\n  setSelectedItems: (items: SelectedItem[]) => void;\n  clearSelection: () => void;\n\n  // Edit actions\n  updateShort: (shortId: number, updates: Partial<ShortEdit>) => void;\n  splitSegment: (segmentIndex: number, sourceTime: number) => void;\n  deleteSegment: (segmentIndex: number) => void;\n  moveOverlay: (overlayIndex: number, newStartAt: number) => void;\n  resizeOverlay: (\n    overlayIndex: number,\n    newStartAt: number,\n    newDuration: number\n  ) => void;\n  addOverlay: (overlay: Overlay) => void;\n  deleteOverlay: (overlayIndex: number) => void;\n  moveSfx: (sfxIndex: number, newAt: number) => void;\n  addSfx: (sfx: SFXCue) => void;\n  deleteSfx: (sfxIndex: number) => void;\n  trimSegment: (\n    segmentIndex: number,\n    edge: \"left\" | \"right\",\n    newTime: number\n  ) => void;\n  updateSubtitleWord: (wordIndex: number, newWord: string) => void;\n\n  // Persistence\n  saveEdits: () => Promise<void>;\n\n  // Pipeline\n  triggerStage: (\n    stage: PipelineStage,\n    extra?: Record<string, unknown>\n  ) => Promise<void>;\n}\n\nfunction getActiveShort(\n  shorts: ShortEdit[],\n  id: number | null\n): ShortEdit | undefined {\n  if (id === null) return undefined;\n  return shorts.find((s) => s.id === id);\n}\n\nexport const useEditorStore = create<EditorState>()(\n  temporal(\n    (set, get) => ({\n      // Initial state\n      runs: [],\n      currentRunId: null,\n      transcript: null,\n      assets: null,\n      shorts: [],\n      activeShortId: null,\n      zoom: 80,\n      scrollX: 0,\n      cursorTime: 0,\n      isPlaying: false,\n      activeTool: \"select\",\n      selectedItems: [],\n      duration: 0,\n      pipelineStatus: {\n        pull: \"idle\",\n        transcribe: \"idle\",\n        analyze: \"idle\",\n        edit: \"idle\",\n        subtitles: \"idle\",\n      },\n      pipelineLogs: [],\n      activeJob: null,\n      isDirty: false,\n\n      fetchRuns: async () => {\n        const runs = await api.listRuns();\n        set({ runs });\n      },\n\n      loadRun: async (runId: string) => {\n        set({ currentRunId: runId, shorts: [], activeShortId: null });\n        try {\n          const [transcript, assets, edits] = await Promise.allSettled([\n            api.getTranscript(runId),\n            api.getAssets(runId),\n            api.getEdits(runId),\n          ]);\n          set({\n            transcript:\n              transcript.status === \"fulfilled\" ? transcript.value : null,\n            assets: assets.status === \"fulfilled\" ? assets.value : null,\n            shorts: edits.status === \"fulfilled\" ? edits.value : [],\n          });\n          // Auto-select first short\n          const shorts =\n            edits.status === \"fulfilled\" ? edits.value : [];\n          if (shorts.length > 0) {\n            get().selectShort(shorts[0].id);\n          }\n        } catch (e) {\n          console.error(\"Failed to load run:\", e);\n        }\n      },\n\n      selectShort: (shortId: number) => {\n        const short = getActiveShort(get().shorts, shortId);\n        set({\n          activeShortId: shortId,\n          cursorTime: 0,\n          scrollX: 0,\n          selectedItems: [],\n          duration: short ? totalConcatDuration(short.segmentsToKeep) : 0,\n        });\n      },\n\n      setZoom: (zoom) => set({ zoom: Math.max(10, Math.min(500, zoom)) }),\n      setScrollX: (scrollX) => set({ scrollX: Math.max(0, scrollX) }),\n      setCursorTime: (cursorTime) => set({ cursorTime: Math.max(0, cursorTime) }),\n      setIsPlaying: (isPlaying) => set({ isPlaying }),\n      togglePlay: () => set((s) => ({ isPlaying: !s.isPlaying })),\n      setActiveTool: (activeTool) => set({ activeTool }),\n      setSelectedItems: (selectedItems) => set({ selectedItems }),\n      clearSelection: () => set({ selectedItems: [] }),\n\n      updateShort: (shortId, updates) => {\n        set((s) => ({\n          shorts: s.shorts.map((sh) =>\n            sh.id === shortId ? { ...sh, ...updates } : sh\n          ),\n          isDirty: true,\n        }));\n      },\n\n      splitSegment: (segmentIndex, sourceTime) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        const seg = short.segmentsToKeep[segmentIndex];\n        if (!seg || sourceTime <= seg.start || sourceTime >= seg.end) return;\n\n        const newSegments = [...short.segmentsToKeep];\n        newSegments.splice(segmentIndex, 1, {\n          start: seg.start,\n          end: sourceTime,\n        }, {\n          start: sourceTime,\n          end: seg.end,\n        });\n\n        get().updateShort(short.id, { segmentsToKeep: newSegments });\n      },\n\n      deleteSegment: (segmentIndex) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short || short.segmentsToKeep.length <= 1) return;\n\n        const newSegments = short.segmentsToKeep.filter(\n          (_, i) => i !== segmentIndex\n        );\n        get().updateShort(short.id, { segmentsToKeep: newSegments });\n        set({\n          duration: totalConcatDuration(newSegments),\n          selectedItems: [],\n        });\n      },\n\n      moveOverlay: (overlayIndex, newStartAt) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        const newOverlays = [...short.overlays];\n        newOverlays[overlayIndex] = {\n          ...newOverlays[overlayIndex],\n          startAt: newStartAt,\n        };\n        get().updateShort(short.id, { overlays: newOverlays });\n      },\n\n      resizeOverlay: (overlayIndex, newStartAt, newDuration) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        const newOverlays = [...short.overlays];\n        newOverlays[overlayIndex] = {\n          ...newOverlays[overlayIndex],\n          startAt: newStartAt,\n          duration: Math.max(0.5, newDuration),\n        };\n        get().updateShort(short.id, { overlays: newOverlays });\n      },\n\n      addOverlay: (overlay) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        get().updateShort(short.id, {\n          overlays: [...short.overlays, overlay],\n        });\n      },\n\n      deleteOverlay: (overlayIndex) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        get().updateShort(short.id, {\n          overlays: short.overlays.filter((_, i) => i !== overlayIndex),\n        });\n        set({ selectedItems: [] });\n      },\n\n      moveSfx: (sfxIndex, newAt) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        const newSfx = [...short.sfx];\n        newSfx[sfxIndex] = { ...newSfx[sfxIndex], at: newAt };\n        get().updateShort(short.id, { sfx: newSfx });\n      },\n\n      addSfx: (sfx) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        get().updateShort(short.id, { sfx: [...short.sfx, sfx] });\n      },\n\n      deleteSfx: (sfxIndex) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        get().updateShort(short.id, {\n          sfx: short.sfx.filter((_, i) => i !== sfxIndex),\n        });\n        set({ selectedItems: [] });\n      },\n\n      trimSegment: (segmentIndex, edge, newTime) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        const seg = short.segmentsToKeep[segmentIndex];\n        if (!seg) return;\n\n        const newSegments = [...short.segmentsToKeep];\n        if (edge === \"left\") {\n          newSegments[segmentIndex] = {\n            start: Math.min(newTime, seg.end - 0.1),\n            end: seg.end,\n          };\n        } else {\n          newSegments[segmentIndex] = {\n            start: seg.start,\n            end: Math.max(newTime, seg.start + 0.1),\n          };\n        }\n\n        get().updateShort(short.id, { segmentsToKeep: newSegments });\n        set({ duration: totalConcatDuration(newSegments) });\n      },\n\n      updateSubtitleWord: (wordIndex, newWord) => {\n        const { activeShortId, shorts } = get();\n        const short = getActiveShort(shorts, activeShortId);\n        if (!short) return;\n        const newWords = [...short.subtitleWords];\n        newWords[wordIndex] = { ...newWords[wordIndex], word: newWord };\n        get().updateShort(short.id, { subtitleWords: newWords });\n      },\n\n      saveEdits: async () => {\n        const { currentRunId, shorts } = get();\n        if (!currentRunId) return;\n        await api.saveEdits(currentRunId, shorts);\n        set({ isDirty: false });\n      },\n\n      triggerStage: async (stage, extra = {}) => {\n        const { currentRunId, activeShortId } = get();\n        if (!currentRunId) return;\n\n        set((s) => ({\n          pipelineStatus: { ...s.pipelineStatus, [stage]: \"running\" },\n          pipelineLogs: [],\n        }));\n\n        try {\n          const body: Record<string, unknown> = {\n            runId: currentRunId,\n            ...extra,\n          };\n          if (\n            (stage === \"edit\" || stage === \"subtitles\") &&\n            activeShortId !== null\n          ) {\n            body.shortId = activeShortId;\n          }\n\n          const { jobId } = await api.triggerPipeline(stage, body);\n          set({ activeJob: { stage, jobId } });\n\n          // Open SSE stream\n          const eventSource = new EventSource(\n            api.pipelineStreamUrl(stage, jobId)\n          );\n\n          eventSource.onmessage = (event) => {\n            try {\n              const data = JSON.parse(event.data);\n              if (data.type === \"log\") {\n                set((s) => ({\n                  pipelineLogs: [...s.pipelineLogs, data.data],\n                }));\n              } else if (data.type === \"done\") {\n                set((s) => ({\n                  pipelineStatus: {\n                    ...s.pipelineStatus,\n                    [stage]: \"success\",\n                  },\n                  activeJob: null,\n                }));\n                eventSource.close();\n                // Reload data after successful stage\n                if (stage === \"analyze\") {\n                  get().loadRun(currentRunId);\n                }\n              } else if (data.type === \"error\") {\n                set((s) => ({\n                  pipelineStatus: {\n                    ...s.pipelineStatus,\n                    [stage]: \"error\",\n                  },\n                  activeJob: null,\n                }));\n                eventSource.close();\n              }\n            } catch {\n              // Non-JSON message, treat as log\n              set((s) => ({\n                pipelineLogs: [...s.pipelineLogs, event.data],\n              }));\n            }\n          };\n\n          eventSource.onerror = () => {\n            set((s) => ({\n              pipelineStatus: { ...s.pipelineStatus, [stage]: \"error\" },\n              activeJob: null,\n            }));\n            eventSource.close();\n          };\n        } catch (e) {\n          console.error(\"Pipeline trigger failed:\", e);\n          set((s) => ({\n            pipelineStatus: { ...s.pipelineStatus, [stage]: \"error\" },\n            activeJob: null,\n          }));\n        }\n      },\n    }),\n    {\n      partialize: (state) => ({\n        shorts: state.shorts,\n      }),\n      limit: 50,\n    }\n  )\n);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 558, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/panels/RunPicker.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useEditorStore } from \"@/lib/store\";\n\nexport default function RunPicker() {\n  const runs = useEditorStore((s) => s.runs);\n  const currentRunId = useEditorStore((s) => s.currentRunId);\n  const fetchRuns = useEditorStore((s) => s.fetchRuns);\n  const loadRun = useEditorStore((s) => s.loadRun);\n\n  useEffect(() => {\n    fetchRuns();\n  }, [fetchRuns]);\n\n  return (\n    <div className=\"flex items-center gap-2 px-3 py-2 border-b\" style={{ borderColor: \"var(--border)\" }}>\n      <label\n        className=\"text-xs font-medium\"\n        style={{ color: \"var(--text-secondary)\" }}\n      >\n        Run\n      </label>\n      <select\n        value={currentRunId || \"\"}\n        onChange={(e) => e.target.value && loadRun(e.target.value)}\n        className=\"flex-1 text-sm\"\n        style={{\n          background: \"var(--bg-tertiary)\",\n          border: \"1px solid var(--border)\",\n          color: \"var(--text-primary)\",\n          borderRadius: 6,\n          padding: \"4px 8px\",\n        }}\n      >\n        <option value=\"\">Select a run...</option>\n        {runs.map((run) => (\n          <option key={run.id} value={run.id}>\n            {run.id}\n            {run.hasEdits ? ` (${run.shortsCount} shorts)` : \"\"}\n            {!run.hasARoll ? \" [no video]\" : \"\"}\n          </option>\n        ))}\n      </select>\n      <button\n        onClick={() => fetchRuns()}\n        className=\"text-xs px-2 py-1 rounded\"\n        style={{\n          background: \"var(--bg-tertiary)\",\n          color: \"var(--text-secondary)\",\n          border: \"1px solid var(--border)\",\n        }}\n      >\n        Refresh\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACtB,MAAM,OAAO,IAAA,wIAAc;0CAAC,CAAC,IAAM,EAAE,IAAI;;IACzC,MAAM,eAAe,IAAA,wIAAc;kDAAC,CAAC,IAAM,EAAE,YAAY;;IACzD,MAAM,YAAY,IAAA,wIAAc;+CAAC,CAAC,IAAM,EAAE,SAAS;;IACnD,MAAM,UAAU,IAAA,wIAAc;6CAAC,CAAC,IAAM,EAAE,OAAO;;IAE/C,IAAA,iLAAS;+BAAC;YACR;QACF;8BAAG;QAAC;KAAU;IAEd,qBACE,oMAAC;QAAI,WAAU;QAA6C,OAAO;YAAE,aAAa;QAAgB;;0BAChG,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,OAAO;gBAAwB;0BACzC;;;;;;0BAGD,oMAAC;gBACC,OAAO,gBAAgB;gBACvB,UAAU,CAAC,IAAM,EAAE,MAAM,CAAC,KAAK,IAAI,QAAQ,EAAE,MAAM,CAAC,KAAK;gBACzD,WAAU;gBACV,OAAO;oBACL,YAAY;oBACZ,QAAQ;oBACR,OAAO;oBACP,cAAc;oBACd,SAAS;gBACX;;kCAEA,oMAAC;wBAAO,OAAM;kCAAG;;;;;;oBAChB,KAAK,GAAG,CAAC,CAAC,oBACT,oMAAC;4BAAoB,OAAO,IAAI,EAAE;;gCAC/B,IAAI,EAAE;gCACN,IAAI,QAAQ,GAAG,AAAC,KAAoB,OAAhB,IAAI,WAAW,EAAC,cAAY;gCAChD,CAAC,IAAI,QAAQ,GAAG,gBAAgB;;2BAHtB,IAAI,EAAE;;;;;;;;;;;0BAOvB,oMAAC;gBACC,SAAS,IAAM;gBACf,WAAU;gBACV,OAAO;oBACL,YAAY;oBACZ,OAAO;oBACP,QAAQ;gBACV;0BACD;;;;;;;;;;;;AAKP;GApDwB;;QACT,wIAAc;QACN,wIAAc;QACjB,wIAAc;QAChB,wIAAc;;;KAJR","debugId":null}},
    {"offset": {"line": 685, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/panels/ShortsList.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEditorStore } from \"@/lib/store\";\nimport { totalConcatDuration, formatTimeShort } from \"@/lib/timeline-utils\";\n\nexport default function ShortsList() {\n  const shorts = useEditorStore((s) => s.shorts);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n  const selectShort = useEditorStore((s) => s.selectShort);\n\n  if (shorts.length === 0) {\n    return (\n      <div\n        className=\"p-4 text-center text-sm\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        No shorts found. Run the Analyze stage to generate edits.\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col gap-1 p-2 overflow-y-auto\" style={{ maxHeight: \"calc(100vh - 400px)\" }}>\n      <div\n        className=\"text-xs font-semibold uppercase tracking-wider px-2 py-1\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        Shorts ({shorts.length})\n      </div>\n      {shorts.map((short) => {\n        const duration = totalConcatDuration(short.segmentsToKeep);\n        const isActive = short.id === activeShortId;\n\n        return (\n          <button\n            key={short.id}\n            onClick={() => selectShort(short.id)}\n            className=\"w-full text-left rounded-lg px-3 py-2.5 transition-colors\"\n            style={{\n              background: isActive ? \"var(--accent-muted)\" : \"transparent\",\n              border: isActive\n                ? \"1px solid var(--accent)\"\n                : \"1px solid transparent\",\n            }}\n          >\n            <div className=\"flex items-center justify-between\">\n              <span\n                className=\"text-xs font-mono\"\n                style={{\n                  color: isActive ? \"var(--accent)\" : \"var(--text-muted)\",\n                }}\n              >\n                #{short.id}\n              </span>\n              <span\n                className=\"text-xs font-mono\"\n                style={{ color: \"var(--text-muted)\" }}\n              >\n                {formatTimeShort(duration)}\n              </span>\n            </div>\n            <div\n              className=\"text-sm mt-0.5 truncate\"\n              style={{\n                color: isActive\n                  ? \"var(--text-primary)\"\n                  : \"var(--text-secondary)\",\n              }}\n            >\n              {short.title}\n            </div>\n            <div\n              className=\"flex gap-2 mt-1 text-xs\"\n              style={{ color: \"var(--text-muted)\" }}\n            >\n              <span>{short.segmentsToKeep.length} segs</span>\n              {short.overlays.length > 0 && (\n                <span style={{ color: \"var(--broll)\" }}>\n                  {short.overlays.length} overlays\n                </span>\n              )}\n              {short.sfx.length > 0 && (\n                <span style={{ color: \"var(--sfx)\" }}>\n                  {short.sfx.length} sfx\n                </span>\n              )}\n            </div>\n          </button>\n        );\n      })}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACtB,MAAM,SAAS,IAAA,wIAAc;6CAAC,CAAC,IAAM,EAAE,MAAM;;IAC7C,MAAM,gBAAgB,IAAA,wIAAc;oDAAC,CAAC,IAAM,EAAE,aAAa;;IAC3D,MAAM,cAAc,IAAA,wIAAc;kDAAC,CAAC,IAAM,EAAE,WAAW;;IAEvD,IAAI,OAAO,MAAM,KAAK,GAAG;QACvB,qBACE,oMAAC;YACC,WAAU;YACV,OAAO;gBAAE,OAAO;YAAoB;sBACrC;;;;;;IAIL;IAEA,qBACE,oMAAC;QAAI,WAAU;QAA0C,OAAO;YAAE,WAAW;QAAsB;;0BACjG,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,OAAO;gBAAoB;;oBACrC;oBACU,OAAO,MAAM;oBAAC;;;;;;;YAExB,OAAO,GAAG,CAAC,CAAC;gBACX,MAAM,WAAW,IAAA,yJAAmB,EAAC,MAAM,cAAc;gBACzD,MAAM,WAAW,MAAM,EAAE,KAAK;gBAE9B,qBACE,oMAAC;oBAEC,SAAS,IAAM,YAAY,MAAM,EAAE;oBACnC,WAAU;oBACV,OAAO;wBACL,YAAY,WAAW,wBAAwB;wBAC/C,QAAQ,WACJ,4BACA;oBACN;;sCAEA,oMAAC;4BAAI,WAAU;;8CACb,oMAAC;oCACC,WAAU;oCACV,OAAO;wCACL,OAAO,WAAW,kBAAkB;oCACtC;;wCACD;wCACG,MAAM,EAAE;;;;;;;8CAEZ,oMAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,OAAO;oCAAoB;8CAEnC,IAAA,qJAAe,EAAC;;;;;;;;;;;;sCAGrB,oMAAC;4BACC,WAAU;4BACV,OAAO;gCACL,OAAO,WACH,wBACA;4BACN;sCAEC,MAAM,KAAK;;;;;;sCAEd,oMAAC;4BACC,WAAU;4BACV,OAAO;gCAAE,OAAO;4BAAoB;;8CAEpC,oMAAC;;wCAAM,MAAM,cAAc,CAAC,MAAM;wCAAC;;;;;;;gCAClC,MAAM,QAAQ,CAAC,MAAM,GAAG,mBACvB,oMAAC;oCAAK,OAAO;wCAAE,OAAO;oCAAe;;wCAClC,MAAM,QAAQ,CAAC,MAAM;wCAAC;;;;;;;gCAG1B,MAAM,GAAG,CAAC,MAAM,GAAG,mBAClB,oMAAC;oCAAK,OAAO;wCAAE,OAAO;oCAAa;;wCAChC,MAAM,GAAG,CAAC,MAAM;wCAAC;;;;;;;;;;;;;;mBAhDnB,MAAM,EAAE;;;;;YAsDnB;;;;;;;AAGN;GAvFwB;;QACP,wIAAc;QACP,wIAAc;QAChB,wIAAc;;;KAHZ","debugId":null}},
    {"offset": {"line": 877, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/pipeline/PipelineControls.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { useEditorStore } from \"@/lib/store\";\nimport type { PipelineStage } from \"@/lib/types\";\n\nconst STAGES: { key: PipelineStage; label: string; description: string }[] = [\n  {\n    key: \"pull\",\n    label: \"Pull\",\n    description: \"Download video & assets from Drive\",\n  },\n  {\n    key: \"transcribe\",\n    label: \"Transcribe\",\n    description: \"Transcribe audio with Whisper\",\n  },\n  {\n    key: \"analyze\",\n    label: \"Auto Edit\",\n    description: \"AI generates shorts from transcript\",\n  },\n  {\n    key: \"edit\",\n    label: \"Render\",\n    description: \"FFmpeg renders the short video\",\n  },\n  {\n    key: \"subtitles\",\n    label: \"Subtitles\",\n    description: \"Add animated captions\",\n  },\n];\n\nconst STATUS_ICONS: Record<string, { icon: string; color: string }> = {\n  idle: { icon: \"○\", color: \"var(--text-muted)\" },\n  running: { icon: \"◎\", color: \"var(--accent)\" },\n  success: { icon: \"●\", color: \"var(--success)\" },\n  error: { icon: \"●\", color: \"var(--error)\" },\n};\n\nexport default function PipelineControls() {\n  const currentRunId = useEditorStore((s) => s.currentRunId);\n  const pipelineStatus = useEditorStore((s) => s.pipelineStatus);\n  const pipelineLogs = useEditorStore((s) => s.pipelineLogs);\n  const activeJob = useEditorStore((s) => s.activeJob);\n  const triggerStage = useEditorStore((s) => s.triggerStage);\n\n  const [showLogs, setShowLogs] = useState(false);\n  const [pullSource, setPullSource] = useState(\"\");\n  const logsEndRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    logsEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [pipelineLogs]);\n\n  return (\n    <div className=\"flex flex-col gap-1 p-2\">\n      <div\n        className=\"text-xs font-semibold uppercase tracking-wider px-2 py-1\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        Pipeline\n      </div>\n\n      {STAGES.map(({ key, label, description }) => {\n        const status = pipelineStatus[key];\n        const { icon, color } = STATUS_ICONS[status];\n        const isRunning = status === \"running\";\n        const isDisabled =\n          isRunning || (!currentRunId && key !== \"pull\");\n\n        return (\n          <div key={key}>\n            {key === \"pull\" && (\n              <input\n                type=\"text\"\n                placeholder=\"Drive ID or local path...\"\n                value={pullSource}\n                onChange={(e) => setPullSource(e.target.value)}\n                className=\"w-full text-xs mb-1 px-2 py-1.5 rounded\"\n                style={{\n                  background: \"var(--bg-tertiary)\",\n                  border: \"1px solid var(--border)\",\n                  color: \"var(--text-primary)\",\n                }}\n              />\n            )}\n            <button\n              onClick={() => {\n                const extra: Record<string, unknown> = {};\n                if (key === \"pull\" && pullSource) {\n                  extra.source = pullSource;\n                }\n                triggerStage(key, extra);\n                setShowLogs(true);\n              }}\n              disabled={isDisabled}\n              className=\"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left transition-all\"\n              style={{\n                background: isRunning\n                  ? \"var(--accent-muted)\"\n                  : \"var(--bg-tertiary)\",\n                border: \"1px solid var(--border)\",\n                opacity: isDisabled && !isRunning ? 0.5 : 1,\n                cursor: isDisabled ? \"not-allowed\" : \"pointer\",\n              }}\n            >\n              <span\n                style={{ color, fontSize: 14 }}\n                className={isRunning ? \"animate-pulse\" : \"\"}\n              >\n                {icon}\n              </span>\n              <div className=\"flex-1 min-w-0\">\n                <div\n                  className=\"text-sm font-medium\"\n                  style={{\n                    color: isRunning\n                      ? \"var(--accent)\"\n                      : \"var(--text-primary)\",\n                  }}\n                >\n                  {label}\n                </div>\n                <div\n                  className=\"text-xs truncate\"\n                  style={{ color: \"var(--text-muted)\" }}\n                >\n                  {description}\n                </div>\n              </div>\n            </button>\n          </div>\n        );\n      })}\n\n      {/* Log viewer */}\n      {showLogs && pipelineLogs.length > 0 && (\n        <div\n          className=\"mt-2 rounded-lg overflow-hidden\"\n          style={{\n            background: \"var(--bg-primary)\",\n            border: \"1px solid var(--border)\",\n          }}\n        >\n          <div\n            className=\"flex items-center justify-between px-2 py-1\"\n            style={{ borderBottom: \"1px solid var(--border)\" }}\n          >\n            <span\n              className=\"text-xs font-medium\"\n              style={{ color: \"var(--text-muted)\" }}\n            >\n              Logs\n            </span>\n            <button\n              onClick={() => setShowLogs(false)}\n              className=\"text-xs px-1\"\n              style={{ color: \"var(--text-muted)\" }}\n            >\n              ×\n            </button>\n          </div>\n          <div\n            className=\"p-2 overflow-y-auto font-mono text-xs leading-relaxed\"\n            style={{\n              maxHeight: 160,\n              color: \"var(--text-secondary)\",\n              whiteSpace: \"pre-wrap\",\n              wordBreak: \"break-all\",\n            }}\n          >\n            {pipelineLogs.map((log, i) => (\n              <div key={i}>{log}</div>\n            ))}\n            <div ref={logsEndRef} />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1179, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/editor/VideoPlayer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useEffect, useCallback } from \"react\";\nimport { useEditorStore } from \"@/lib/store\";\nimport { mediaUrl } from \"@/lib/api\";\nimport {\n  concatToSourceTime,\n  sourceToConcatTime,\n  formatTime,\n} from \"@/lib/timeline-utils\";\n\nexport default function VideoPlayer() {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const animRef = useRef<number>(0);\n\n  const currentRunId = useEditorStore((s) => s.currentRunId);\n  const shorts = useEditorStore((s) => s.shorts);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n  const isPlaying = useEditorStore((s) => s.isPlaying);\n  const cursorTime = useEditorStore((s) => s.cursorTime);\n  const duration = useEditorStore((s) => s.duration);\n  const setCursorTime = useEditorStore((s) => s.setCursorTime);\n  const setIsPlaying = useEditorStore((s) => s.setIsPlaying);\n\n  const activeShort = shorts.find((s) => s.id === activeShortId);\n  const segments = activeShort?.segmentsToKeep ?? [];\n\n  const videoSrc = currentRunId\n    ? mediaUrl(`runs/${currentRunId}/a-roll.mp4`)\n    : \"\";\n\n  // Seek video when cursor time changes (from timeline click etc.)\n  useEffect(() => {\n    if (!videoRef.current || segments.length === 0) return;\n    const sourceTime = concatToSourceTime(cursorTime, segments);\n    const currentSourceTime = videoRef.current.currentTime;\n    if (Math.abs(currentSourceTime - sourceTime) > 0.1) {\n      videoRef.current.currentTime = sourceTime;\n    }\n  }, [cursorTime, segments]);\n\n  // Playback loop: sync video time to store, handle segment jumps\n  const playbackLoop = useCallback(() => {\n    if (!videoRef.current || segments.length === 0) return;\n\n    const sourceTime = videoRef.current.currentTime;\n\n    // Find which segment we're in\n    const currentSegIdx = segments.findIndex(\n      (seg) => sourceTime >= seg.start - 0.05 && sourceTime <= seg.end + 0.05\n    );\n\n    if (currentSegIdx === -1) {\n      // We're in a gap - jump to the nearest next segment\n      const nextSeg = segments.find((seg) => seg.start > sourceTime);\n      if (nextSeg) {\n        videoRef.current.currentTime = nextSeg.start;\n      } else {\n        videoRef.current.pause();\n        setIsPlaying(false);\n        return;\n      }\n    } else if (sourceTime >= segments[currentSegIdx].end - 0.03) {\n      // End of current segment - jump to next or stop\n      if (currentSegIdx < segments.length - 1) {\n        videoRef.current.currentTime = segments[currentSegIdx + 1].start;\n      } else {\n        videoRef.current.pause();\n        setIsPlaying(false);\n        return;\n      }\n    }\n\n    // Update cursor time from video position\n    const concatTime = sourceToConcatTime(\n      videoRef.current.currentTime,\n      segments\n    );\n    if (concatTime !== null) {\n      setCursorTime(concatTime);\n    }\n\n    animRef.current = requestAnimationFrame(playbackLoop);\n  }, [segments, setCursorTime, setIsPlaying]);\n\n  // Start/stop playback\n  useEffect(() => {\n    if (!videoRef.current) return;\n\n    if (isPlaying) {\n      const sourceTime = concatToSourceTime(cursorTime, segments);\n      videoRef.current.currentTime = sourceTime;\n      videoRef.current.play().catch(() => setIsPlaying(false));\n      animRef.current = requestAnimationFrame(playbackLoop);\n    } else {\n      videoRef.current.pause();\n      cancelAnimationFrame(animRef.current);\n    }\n\n    return () => cancelAnimationFrame(animRef.current);\n  }, [isPlaying]);\n\n  const handleFrameStep = useCallback(\n    (direction: 1 | -1) => {\n      const frameTime = 1 / 30;\n      const newTime = Math.max(\n        0,\n        Math.min(duration, cursorTime + direction * frameTime)\n      );\n      setCursorTime(newTime);\n    },\n    [cursorTime, duration, setCursorTime]\n  );\n\n  return (\n    <div\n      className=\"flex flex-col h-full\"\n      style={{ background: \"var(--bg-primary)\" }}\n    >\n      {/* Video container */}\n      <div className=\"flex-1 flex items-center justify-center overflow-hidden relative\">\n        {videoSrc ? (\n          <video\n            ref={videoRef}\n            src={videoSrc}\n            className=\"max-h-full max-w-full object-contain\"\n            style={{ borderRadius: 4 }}\n            preload=\"auto\"\n          />\n        ) : (\n          <div\n            className=\"text-sm\"\n            style={{ color: \"var(--text-muted)\" }}\n          >\n            Select a run to load video\n          </div>\n        )}\n      </div>\n\n      {/* Transport controls */}\n      <div\n        className=\"flex items-center gap-3 px-4 py-2 border-t\"\n        style={{\n          borderColor: \"var(--border)\",\n          background: \"var(--bg-secondary)\",\n        }}\n      >\n        {/* Frame back */}\n        <button\n          onClick={() => handleFrameStep(-1)}\n          className=\"p-1.5 rounded hover:opacity-80\"\n          style={{ color: \"var(--text-secondary)\" }}\n          title=\"Previous frame (←)\"\n        >\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M6 6h2v12H6zm3.5 6 8.5 6V6z\" />\n          </svg>\n        </button>\n\n        {/* Play/Pause */}\n        <button\n          onClick={() => useEditorStore.getState().togglePlay()}\n          className=\"p-2 rounded-full\"\n          style={{\n            background: \"var(--accent)\",\n            color: \"#fff\",\n          }}\n          title=\"Play/Pause (Space)\"\n        >\n          {isPlaying ? (\n            <svg\n              width=\"18\"\n              height=\"18\"\n              viewBox=\"0 0 24 24\"\n              fill=\"currentColor\"\n            >\n              <path d=\"M6 4h4v16H6zM14 4h4v16h-4z\" />\n            </svg>\n          ) : (\n            <svg\n              width=\"18\"\n              height=\"18\"\n              viewBox=\"0 0 24 24\"\n              fill=\"currentColor\"\n            >\n              <path d=\"M8 5v14l11-7z\" />\n            </svg>\n          )}\n        </button>\n\n        {/* Frame forward */}\n        <button\n          onClick={() => handleFrameStep(1)}\n          className=\"p-1.5 rounded hover:opacity-80\"\n          style={{ color: \"var(--text-secondary)\" }}\n          title=\"Next frame (→)\"\n        >\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n            <path d=\"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z\" />\n          </svg>\n        </button>\n\n        {/* Time display */}\n        <div className=\"flex-1\" />\n        <span\n          className=\"font-mono text-sm tabular-nums\"\n          style={{ color: \"var(--text-secondary)\" }}\n        >\n          {formatTime(cursorTime)} / {formatTime(duration)}\n        </span>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1521, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/editor/Toolbar.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEditorStore } from \"@/lib/store\";\nimport { formatTime } from \"@/lib/timeline-utils\";\n\nexport default function Toolbar() {\n  const activeTool = useEditorStore((s) => s.activeTool);\n  const setActiveTool = useEditorStore((s) => s.setActiveTool);\n  const zoom = useEditorStore((s) => s.zoom);\n  const setZoom = useEditorStore((s) => s.setZoom);\n  const cursorTime = useEditorStore((s) => s.cursorTime);\n  const duration = useEditorStore((s) => s.duration);\n  const isDirty = useEditorStore((s) => s.isDirty);\n  const saveEdits = useEditorStore((s) => s.saveEdits);\n  const triggerStage = useEditorStore((s) => s.triggerStage);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n\n  const tools: {\n    key: typeof activeTool;\n    label: string;\n    shortcut: string;\n    icon: string;\n  }[] = [\n    { key: \"select\", label: \"Select\", shortcut: \"V\", icon: \"↖\" },\n    { key: \"cut\", label: \"Cut\", shortcut: \"C\", icon: \"✂\" },\n    { key: \"trim\", label: \"Trim\", shortcut: \"T\", icon: \"⇔\" },\n  ];\n\n  return (\n    <div\n      className=\"flex items-center gap-2 px-3 py-1.5 border-t\"\n      style={{\n        borderColor: \"var(--border)\",\n        background: \"var(--bg-secondary)\",\n      }}\n    >\n      {/* Tool buttons */}\n      <div className=\"flex gap-1\">\n        {tools.map((tool) => (\n          <button\n            key={tool.key}\n            onClick={() => setActiveTool(tool.key)}\n            className=\"flex items-center gap-1 px-2.5 py-1 rounded text-sm transition-colors\"\n            title={`${tool.label} (${tool.shortcut})`}\n            style={{\n              background:\n                activeTool === tool.key\n                  ? \"var(--accent-muted)\"\n                  : \"transparent\",\n              color:\n                activeTool === tool.key\n                  ? \"var(--accent)\"\n                  : \"var(--text-secondary)\",\n              border:\n                activeTool === tool.key\n                  ? \"1px solid var(--accent)\"\n                  : \"1px solid transparent\",\n            }}\n          >\n            <span>{tool.icon}</span>\n            <span className=\"text-xs\">{tool.label}</span>\n          </button>\n        ))}\n      </div>\n\n      <div\n        className=\"w-px h-5 mx-1\"\n        style={{ background: \"var(--border)\" }}\n      />\n\n      {/* Zoom */}\n      <div className=\"flex items-center gap-1.5\">\n        <button\n          onClick={() => setZoom(zoom * 0.8)}\n          className=\"px-1.5 py-0.5 rounded text-xs\"\n          style={{\n            color: \"var(--text-secondary)\",\n            background: \"var(--bg-tertiary)\",\n          }}\n        >\n          −\n        </button>\n        <input\n          type=\"range\"\n          min={10}\n          max={500}\n          value={zoom}\n          onChange={(e) => setZoom(Number(e.target.value))}\n          className=\"w-20 h-1 accent-indigo-500\"\n          style={{ accentColor: \"var(--accent)\" }}\n        />\n        <button\n          onClick={() => setZoom(zoom * 1.2)}\n          className=\"px-1.5 py-0.5 rounded text-xs\"\n          style={{\n            color: \"var(--text-secondary)\",\n            background: \"var(--bg-tertiary)\",\n          }}\n        >\n          +\n        </button>\n        <span\n          className=\"text-xs font-mono w-12\"\n          style={{ color: \"var(--text-muted)\" }}\n        >\n          {Math.round(zoom)}px/s\n        </span>\n      </div>\n\n      <div className=\"flex-1\" />\n\n      {/* Time display */}\n      <span\n        className=\"font-mono text-sm tabular-nums\"\n        style={{ color: \"var(--text-secondary)\" }}\n      >\n        {formatTime(cursorTime)} / {formatTime(duration)}\n      </span>\n\n      <div\n        className=\"w-px h-5 mx-1\"\n        style={{ background: \"var(--border)\" }}\n      />\n\n      {/* Undo/Redo */}\n      <button\n        onClick={() => useEditorStore.temporal.getState().undo()}\n        className=\"px-2 py-1 rounded text-xs\"\n        style={{\n          color: \"var(--text-secondary)\",\n          background: \"var(--bg-tertiary)\",\n        }}\n        title=\"Undo (Ctrl+Z)\"\n      >\n        Undo\n      </button>\n      <button\n        onClick={() => useEditorStore.temporal.getState().redo()}\n        className=\"px-2 py-1 rounded text-xs\"\n        style={{\n          color: \"var(--text-secondary)\",\n          background: \"var(--bg-tertiary)\",\n        }}\n        title=\"Redo (Ctrl+Shift+Z)\"\n      >\n        Redo\n      </button>\n\n      <div\n        className=\"w-px h-5 mx-1\"\n        style={{ background: \"var(--border)\" }}\n      />\n\n      {/* Save */}\n      <button\n        onClick={() => saveEdits()}\n        className=\"px-3 py-1 rounded text-xs font-medium transition-colors\"\n        style={{\n          background: isDirty ? \"var(--accent)\" : \"var(--bg-tertiary)\",\n          color: isDirty ? \"#fff\" : \"var(--text-secondary)\",\n        }}\n        title=\"Save (Ctrl+S)\"\n      >\n        {isDirty ? \"Save*\" : \"Saved\"}\n      </button>\n\n      {/* Re-render */}\n      {activeShortId !== null && (\n        <button\n          onClick={async () => {\n            await saveEdits();\n            await triggerStage(\"edit\");\n          }}\n          className=\"px-3 py-1 rounded text-xs font-medium\"\n          style={{\n            background: \"var(--bg-tertiary)\",\n            color: \"var(--text-secondary)\",\n            border: \"1px solid var(--border)\",\n          }}\n          title=\"Re-render current short\"\n        >\n          Re-render\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1837, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/editor/Timeline.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  useRef,\n  useEffect,\n  useCallback,\n  useState,\n  type MouseEvent,\n} from \"react\";\nimport { useEditorStore } from \"@/lib/store\";\nimport {\n  sourceToConcatTime,\n  concatToSourceTime,\n  totalConcatDuration,\n  timeToPixel,\n  pixelToTime,\n  formatTimeShort,\n  formatTime,\n} from \"@/lib/timeline-utils\";\nimport type {\n  ShortEdit,\n  KeepSegment,\n  Overlay,\n  SFXCue,\n  WordTimestamp,\n  SelectedItem,\n  TrackConfig,\n  DEFAULT_TRACKS,\n} from \"@/lib/types\";\n\n// Track config\nconst TRACKS: TrackConfig[] = [\n  { id: \"aroll\", type: \"aroll\", label: \"A-Roll\", height: 72, color: \"#3b82f6\" },\n  { id: \"overlay\", type: \"overlay\", label: \"Overlays\", height: 56, color: \"#6366f1\" },\n  { id: \"subtitle\", type: \"subtitle\", label: \"Subtitles\", height: 44, color: \"#a855f7\" },\n  { id: \"sfx\", type: \"sfx\", label: \"SFX\", height: 36, color: \"#f59e0b\" },\n];\n\nconst RULER_HEIGHT = 28;\nconst TRACK_GAP = 2;\nconst LABEL_WIDTH = 72;\n\ninterface DragState {\n  mode: \"idle\" | \"dragging\" | \"trimming\" | \"scrubbing\";\n  item?: SelectedItem;\n  edge?: \"left\" | \"right\";\n  startX?: number;\n  startTime?: number;\n  originalValue?: number;\n}\n\nexport default function Timeline() {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [dragState, setDragState] = useState<DragState>({ mode: \"idle\" });\n  const [canvasSize, setCanvasSize] = useState({ width: 0, height: 0 });\n\n  const shorts = useEditorStore((s) => s.shorts);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n  const zoom = useEditorStore((s) => s.zoom);\n  const scrollX = useEditorStore((s) => s.scrollX);\n  const cursorTime = useEditorStore((s) => s.cursorTime);\n  const duration = useEditorStore((s) => s.duration);\n  const activeTool = useEditorStore((s) => s.activeTool);\n  const selectedItems = useEditorStore((s) => s.selectedItems);\n  const setCursorTime = useEditorStore((s) => s.setCursorTime);\n  const setZoom = useEditorStore((s) => s.setZoom);\n  const setScrollX = useEditorStore((s) => s.setScrollX);\n  const setSelectedItems = useEditorStore((s) => s.setSelectedItems);\n  const splitSegment = useEditorStore((s) => s.splitSegment);\n  const moveOverlay = useEditorStore((s) => s.moveOverlay);\n  const resizeOverlay = useEditorStore((s) => s.resizeOverlay);\n  const moveSfx = useEditorStore((s) => s.moveSfx);\n  const trimSegment = useEditorStore((s) => s.trimSegment);\n  const deleteSegment = useEditorStore((s) => s.deleteSegment);\n  const deleteOverlay = useEditorStore((s) => s.deleteOverlay);\n  const deleteSfx = useEditorStore((s) => s.deleteSfx);\n\n  const activeShort = shorts.find((s) => s.id === activeShortId);\n\n  // Compute total height\n  const totalTrackHeight = TRACKS.reduce(\n    (sum, t) => sum + t.height + TRACK_GAP,\n    0\n  );\n  const canvasHeight = RULER_HEIGHT + totalTrackHeight + 8;\n\n  // Resize observer\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n    const observer = new ResizeObserver((entries) => {\n      const { width } = entries[0].contentRect;\n      setCanvasSize({ width, height: canvasHeight });\n    });\n    observer.observe(container);\n    return () => observer.disconnect();\n  }, [canvasHeight]);\n\n  // Helper: get Y offset for a track\n  const getTrackY = useCallback(\n    (trackIndex: number): number => {\n      let y = RULER_HEIGHT;\n      for (let i = 0; i < trackIndex; i++) {\n        y += TRACKS[i].height + TRACK_GAP;\n      }\n      return y;\n    },\n    []\n  );\n\n  // Helper: find which track a Y coordinate falls in\n  const getTrackAtY = useCallback(\n    (y: number): number => {\n      let currentY = RULER_HEIGHT;\n      for (let i = 0; i < TRACKS.length; i++) {\n        if (y >= currentY && y < currentY + TRACKS[i].height) return i;\n        currentY += TRACKS[i].height + TRACK_GAP;\n      }\n      return -1;\n    },\n    []\n  );\n\n  // Render canvas\n  const render = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas || !activeShort) return;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    const dpr = window.devicePixelRatio || 1;\n    canvas.width = canvasSize.width * dpr;\n    canvas.height = canvasSize.height * dpr;\n    ctx.scale(dpr, dpr);\n\n    const w = canvasSize.width;\n    const h = canvasSize.height;\n\n    // Clear\n    ctx.fillStyle = \"#0f0f17\";\n    ctx.fillRect(0, 0, w, h);\n\n    const txp = (time: number) => timeToPixel(time, zoom, scrollX) + LABEL_WIDTH;\n\n    // --- Ruler ---\n    ctx.fillStyle = \"#151520\";\n    ctx.fillRect(0, 0, w, RULER_HEIGHT);\n    ctx.strokeStyle = \"#2a2a3a\";\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.moveTo(0, RULER_HEIGHT);\n    ctx.lineTo(w, RULER_HEIGHT);\n    ctx.stroke();\n\n    // Time ticks\n    const tickInterval = getTickInterval(zoom);\n    const startTime = Math.floor(pixelToTime(-LABEL_WIDTH + scrollX, zoom, 0) / tickInterval) * tickInterval;\n    const endTime = pixelToTime(w - LABEL_WIDTH + scrollX, zoom, 0);\n\n    ctx.font = \"10px -apple-system, sans-serif\";\n    ctx.fillStyle = \"#606078\";\n    ctx.textAlign = \"center\";\n\n    for (let t = startTime; t <= endTime; t += tickInterval) {\n      if (t < 0) continue;\n      const x = txp(t);\n      if (x < LABEL_WIDTH || x > w) continue;\n\n      // Major tick\n      ctx.strokeStyle = \"#2a2a3a\";\n      ctx.beginPath();\n      ctx.moveTo(x, RULER_HEIGHT - 8);\n      ctx.lineTo(x, RULER_HEIGHT);\n      ctx.stroke();\n\n      ctx.fillText(formatTimeShort(t), x, RULER_HEIGHT - 12);\n\n      // Minor ticks\n      const minorInterval = tickInterval / 4;\n      for (let mt = t + minorInterval; mt < t + tickInterval; mt += minorInterval) {\n        const mx = txp(mt);\n        if (mx < LABEL_WIDTH || mx > w) continue;\n        ctx.strokeStyle = \"#1e1e2a\";\n        ctx.beginPath();\n        ctx.moveTo(mx, RULER_HEIGHT - 4);\n        ctx.lineTo(mx, RULER_HEIGHT);\n        ctx.stroke();\n      }\n    }\n\n    // --- Track labels ---\n    TRACKS.forEach((track, i) => {\n      const y = getTrackY(i);\n      ctx.fillStyle = \"#12121a\";\n      ctx.fillRect(0, y, LABEL_WIDTH, track.height);\n      ctx.strokeStyle = \"#2a2a3a\";\n      ctx.strokeRect(0, y, LABEL_WIDTH, track.height);\n      ctx.fillStyle = \"#9090a8\";\n      ctx.font = \"11px -apple-system, sans-serif\";\n      ctx.textAlign = \"left\";\n      ctx.fillText(track.label, 8, y + track.height / 2 + 4);\n    });\n\n    // --- Track backgrounds ---\n    TRACKS.forEach((track, i) => {\n      const y = getTrackY(i);\n      ctx.fillStyle = \"#0d0d15\";\n      ctx.fillRect(LABEL_WIDTH, y, w - LABEL_WIDTH, track.height);\n    });\n\n    // --- A-Roll segments ---\n    const arollY = getTrackY(0);\n    const arollH = TRACKS[0].height;\n    let concatOffset = 0;\n\n    activeShort.segmentsToKeep.forEach((seg, i) => {\n      const segDuration = seg.end - seg.start;\n      const x = txp(concatOffset);\n      const segW = segDuration * zoom;\n      const isSelected = selectedItems.some(\n        (s) => s.type === \"segment\" && s.index === i\n      );\n\n      if (x + segW > LABEL_WIDTH && x < w) {\n        // Segment body\n        const clampX = Math.max(LABEL_WIDTH, x);\n        const clampW = Math.min(x + segW, w) - clampX;\n\n        ctx.fillStyle = isSelected\n          ? \"rgba(59, 130, 246, 0.45)\"\n          : \"rgba(59, 130, 246, 0.25)\";\n        ctx.fillRect(clampX, arollY + 2, clampW, arollH - 4);\n\n        // Border\n        ctx.strokeStyle = isSelected ? \"#60a5fa\" : \"#3b82f6\";\n        ctx.lineWidth = isSelected ? 2 : 1;\n        ctx.strokeRect(clampX, arollY + 2, clampW, arollH - 4);\n\n        // Label\n        if (segW > 40) {\n          ctx.fillStyle = \"#93bbfc\";\n          ctx.font = \"10px -apple-system, sans-serif\";\n          ctx.textAlign = \"left\";\n          const labelX = Math.max(clampX + 6, LABEL_WIDTH + 6);\n          ctx.fillText(\n            `${formatTimeShort(seg.start)}–${formatTimeShort(seg.end)}`,\n            labelX,\n            arollY + 16\n          );\n        }\n\n        // Trim handles (when selected)\n        if (isSelected) {\n          // Left handle\n          ctx.fillStyle = \"#60a5fa\";\n          ctx.fillRect(clampX, arollY + 2, 4, arollH - 4);\n          // Right handle\n          ctx.fillRect(clampX + clampW - 4, arollY + 2, 4, arollH - 4);\n        }\n      }\n\n      // Segment boundary marker\n      if (i > 0) {\n        ctx.strokeStyle = \"rgba(59, 130, 246, 0.4)\";\n        ctx.setLineDash([3, 3]);\n        ctx.beginPath();\n        ctx.moveTo(x, arollY);\n        ctx.lineTo(x, arollY + arollH);\n        ctx.stroke();\n        ctx.setLineDash([]);\n      }\n\n      concatOffset += segDuration;\n    });\n\n    // --- Overlays ---\n    const overlayY = getTrackY(1);\n    const overlayH = TRACKS[1].height;\n\n    activeShort.overlays.forEach((overlay, i) => {\n      const concatStart = sourceToConcatTime(\n        overlay.startAt,\n        activeShort.segmentsToKeep\n      );\n      if (concatStart === null) return;\n\n      const x = txp(concatStart);\n      const ovW = overlay.duration * zoom;\n      const isSelected = selectedItems.some(\n        (s) => s.type === \"overlay\" && s.index === i\n      );\n\n      if (x + ovW > LABEL_WIDTH && x < w) {\n        const clampX = Math.max(LABEL_WIDTH, x);\n        const clampW = Math.min(x + ovW, w) - clampX;\n        const color =\n          overlay.type === \"broll\"\n            ? \"rgba(99, 102, 241, 0.35)\"\n            : \"rgba(34, 197, 94, 0.35)\";\n        const borderColor =\n          overlay.type === \"broll\" ? \"#818cf8\" : \"#4ade80\";\n\n        ctx.fillStyle = isSelected\n          ? overlay.type === \"broll\"\n            ? \"rgba(99, 102, 241, 0.55)\"\n            : \"rgba(34, 197, 94, 0.55)\"\n          : color;\n        ctx.fillRect(clampX, overlayY + 2, clampW, overlayH - 4);\n\n        ctx.strokeStyle = isSelected ? \"#fff\" : borderColor;\n        ctx.lineWidth = isSelected ? 2 : 1;\n        ctx.strokeRect(clampX, overlayY + 2, clampW, overlayH - 4);\n\n        if (ovW > 30) {\n          ctx.fillStyle = \"#fff\";\n          ctx.font = \"10px -apple-system, sans-serif\";\n          ctx.textAlign = \"left\";\n          const labelX = Math.max(clampX + 4, LABEL_WIDTH + 4);\n          ctx.fillText(\n            overlay.matchLabel,\n            labelX,\n            overlayY + overlayH / 2 + 3\n          );\n        }\n\n        // Resize handles\n        if (isSelected) {\n          ctx.fillStyle = \"#fff\";\n          ctx.fillRect(clampX, overlayY + 2, 3, overlayH - 4);\n          ctx.fillRect(clampX + clampW - 3, overlayY + 2, 3, overlayH - 4);\n        }\n      }\n    });\n\n    // --- Subtitles ---\n    const subY = getTrackY(2);\n    const subH = TRACKS[2].height;\n    const WORDS_PER_GROUP = 5;\n\n    if (activeShort.subtitleWords.length > 0) {\n      for (\n        let gi = 0;\n        gi < activeShort.subtitleWords.length;\n        gi += WORDS_PER_GROUP\n      ) {\n        const groupWords = activeShort.subtitleWords.slice(\n          gi,\n          gi + WORDS_PER_GROUP\n        );\n        const firstWord = groupWords[0];\n        const lastWord = groupWords[groupWords.length - 1];\n\n        const concatStart = sourceToConcatTime(\n          firstWord.start,\n          activeShort.segmentsToKeep\n        );\n        const concatEnd = sourceToConcatTime(\n          lastWord.end,\n          activeShort.segmentsToKeep\n        );\n        if (concatStart === null || concatEnd === null) continue;\n\n        const x = txp(concatStart);\n        const subW = (concatEnd - concatStart) * zoom;\n        const isSelected = selectedItems.some(\n          (s) => s.type === \"subtitle\" && s.index === gi\n        );\n\n        if (x + subW > LABEL_WIDTH && x < w && subW > 2) {\n          const clampX = Math.max(LABEL_WIDTH, x);\n          const clampW = Math.min(x + subW, w) - clampX;\n\n          ctx.fillStyle = isSelected\n            ? \"rgba(168, 85, 247, 0.45)\"\n            : \"rgba(168, 85, 247, 0.2)\";\n          ctx.fillRect(clampX, subY + 2, clampW, subH - 4);\n\n          ctx.strokeStyle = isSelected ? \"#c084fc\" : \"rgba(168, 85, 247, 0.4)\";\n          ctx.lineWidth = 1;\n          ctx.strokeRect(clampX, subY + 2, clampW, subH - 4);\n\n          if (subW > 20) {\n            ctx.fillStyle = \"#d8b4fe\";\n            ctx.font = \"9px -apple-system, sans-serif\";\n            ctx.textAlign = \"left\";\n            const text = groupWords.map((w) => w.word).join(\" \");\n            const labelX = Math.max(clampX + 3, LABEL_WIDTH + 3);\n            ctx.fillText(text, labelX, subY + subH / 2 + 3, clampW - 6);\n          }\n        }\n      }\n    }\n\n    // --- SFX ---\n    const sfxY = getTrackY(3);\n    const sfxH = TRACKS[3].height;\n\n    activeShort.sfx.forEach((sfx, i) => {\n      const concatStart = sourceToConcatTime(\n        sfx.at,\n        activeShort.segmentsToKeep\n      );\n      if (concatStart === null) return;\n\n      const x = txp(concatStart);\n      const isSelected = selectedItems.some(\n        (s) => s.type === \"sfx\" && s.index === i\n      );\n\n      if (x > LABEL_WIDTH && x < w) {\n        // Diamond marker\n        ctx.fillStyle = isSelected\n          ? \"rgba(245, 158, 11, 0.8)\"\n          : \"rgba(245, 158, 11, 0.5)\";\n        ctx.beginPath();\n        const size = 8;\n        ctx.moveTo(x, sfxY + sfxH / 2 - size);\n        ctx.lineTo(x + size, sfxY + sfxH / 2);\n        ctx.moveTo(x, sfxY + sfxH / 2 + size);\n        ctx.lineTo(x - size, sfxY + sfxH / 2);\n        ctx.closePath();\n        ctx.fill();\n\n        // Vertical line\n        ctx.strokeStyle = isSelected\n          ? \"rgba(245, 158, 11, 0.8)\"\n          : \"rgba(245, 158, 11, 0.3)\";\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        ctx.moveTo(x, sfxY);\n        ctx.lineTo(x, sfxY + sfxH);\n        ctx.stroke();\n\n        // Label\n        ctx.fillStyle = \"#fbbf24\";\n        ctx.font = \"9px -apple-system, sans-serif\";\n        ctx.textAlign = \"left\";\n        ctx.fillText(sfx.matchLabel, x + 6, sfxY + 12);\n      }\n    });\n\n    // --- Emphasis word markers on a-roll track ---\n    activeShort.emphasisWords.forEach((ew) => {\n      const concatT = sourceToConcatTime(\n        ew.timestamp,\n        activeShort.segmentsToKeep\n      );\n      if (concatT === null) return;\n      const x = txp(concatT);\n      if (x < LABEL_WIDTH || x > w) return;\n\n      // Small triangle above a-roll\n      ctx.fillStyle = \"#ffd700\";\n      ctx.beginPath();\n      ctx.moveTo(x - 4, arollY + arollH - 2);\n      ctx.lineTo(x + 4, arollY + arollH - 2);\n      ctx.lineTo(x, arollY + arollH - 10);\n      ctx.closePath();\n      ctx.fill();\n    });\n\n    // --- Playhead ---\n    const playheadX = txp(cursorTime);\n    if (playheadX >= LABEL_WIDTH && playheadX <= w) {\n      ctx.strokeStyle = \"#ef4444\";\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.moveTo(playheadX, 0);\n      ctx.lineTo(playheadX, h);\n      ctx.stroke();\n\n      // Playhead triangle\n      ctx.fillStyle = \"#ef4444\";\n      ctx.beginPath();\n      ctx.moveTo(playheadX - 6, 0);\n      ctx.lineTo(playheadX + 6, 0);\n      ctx.lineTo(playheadX, 8);\n      ctx.closePath();\n      ctx.fill();\n    }\n\n    // --- Cut tool cursor line ---\n    if (activeTool === \"cut\" && dragState.mode === \"idle\") {\n      // Will be rendered on mousemove via separate state\n    }\n  }, [\n    canvasSize,\n    activeShort,\n    zoom,\n    scrollX,\n    cursorTime,\n    selectedItems,\n    activeTool,\n    duration,\n    getTrackY,\n    dragState,\n  ]);\n\n  // Render loop\n  useEffect(() => {\n    const frame = requestAnimationFrame(render);\n    return () => cancelAnimationFrame(frame);\n  }, [render]);\n\n  // Hit test: what's at this position?\n  const hitTest = useCallback(\n    (\n      canvasX: number,\n      canvasY: number\n    ): { item: SelectedItem; edge?: \"left\" | \"right\" } | null => {\n      if (!activeShort) return null;\n\n      const time = pixelToTime(canvasX - LABEL_WIDTH + scrollX, zoom, 0);\n      const trackIdx = getTrackAtY(canvasY);\n\n      if (trackIdx === 0) {\n        // A-Roll segments\n        let concatOffset = 0;\n        for (let i = 0; i < activeShort.segmentsToKeep.length; i++) {\n          const seg = activeShort.segmentsToKeep[i];\n          const segDur = seg.end - seg.start;\n          if (time >= concatOffset && time <= concatOffset + segDur) {\n            // Check trim edges (8px threshold)\n            const leftEdgeTime = concatOffset;\n            const rightEdgeTime = concatOffset + segDur;\n            const threshold = 8 / zoom; // pixels to time\n\n            if (Math.abs(time - leftEdgeTime) < threshold) {\n              return { item: { type: \"segment\", index: i }, edge: \"left\" };\n            }\n            if (Math.abs(time - rightEdgeTime) < threshold) {\n              return { item: { type: \"segment\", index: i }, edge: \"right\" };\n            }\n            return { item: { type: \"segment\", index: i } };\n          }\n          concatOffset += segDur;\n        }\n      } else if (trackIdx === 1) {\n        // Overlays\n        for (let i = 0; i < activeShort.overlays.length; i++) {\n          const ov = activeShort.overlays[i];\n          const concatStart = sourceToConcatTime(\n            ov.startAt,\n            activeShort.segmentsToKeep\n          );\n          if (concatStart === null) continue;\n          if (time >= concatStart && time <= concatStart + ov.duration) {\n            const threshold = 8 / zoom;\n            if (Math.abs(time - concatStart) < threshold) {\n              return { item: { type: \"overlay\", index: i }, edge: \"left\" };\n            }\n            if (Math.abs(time - (concatStart + ov.duration)) < threshold) {\n              return { item: { type: \"overlay\", index: i }, edge: \"right\" };\n            }\n            return { item: { type: \"overlay\", index: i } };\n          }\n        }\n      } else if (trackIdx === 2) {\n        // Subtitles\n        const WORDS_PER_GROUP = 5;\n        for (\n          let gi = 0;\n          gi < activeShort.subtitleWords.length;\n          gi += WORDS_PER_GROUP\n        ) {\n          const group = activeShort.subtitleWords.slice(gi, gi + WORDS_PER_GROUP);\n          const first = group[0];\n          const last = group[group.length - 1];\n          const concatStart = sourceToConcatTime(\n            first.start,\n            activeShort.segmentsToKeep\n          );\n          const concatEnd = sourceToConcatTime(\n            last.end,\n            activeShort.segmentsToKeep\n          );\n          if (concatStart !== null && concatEnd !== null) {\n            if (time >= concatStart && time <= concatEnd) {\n              return { item: { type: \"subtitle\", index: gi } };\n            }\n          }\n        }\n      } else if (trackIdx === 3) {\n        // SFX\n        for (let i = 0; i < activeShort.sfx.length; i++) {\n          const sfx = activeShort.sfx[i];\n          const concatStart = sourceToConcatTime(\n            sfx.at,\n            activeShort.segmentsToKeep\n          );\n          if (concatStart !== null && Math.abs(time - concatStart) < 12 / zoom) {\n            return { item: { type: \"sfx\", index: i } };\n          }\n        }\n      }\n\n      return null;\n    },\n    [activeShort, zoom, scrollX, getTrackAtY]\n  );\n\n  // Mouse handlers\n  const handleMouseDown = useCallback(\n    (e: MouseEvent<HTMLCanvasElement>) => {\n      if (!activeShort) return;\n      const rect = canvasRef.current!.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      const time = pixelToTime(x - LABEL_WIDTH + scrollX, zoom, 0);\n\n      // Ruler click = scrub\n      if (y < RULER_HEIGHT) {\n        setCursorTime(Math.max(0, Math.min(duration, time)));\n        setDragState({ mode: \"scrubbing\" });\n        return;\n      }\n\n      // Cut tool\n      if (activeTool === \"cut\") {\n        const hit = hitTest(x, y);\n        if (hit && hit.item.type === \"segment\") {\n          const sourceTime = concatToSourceTime(\n            time,\n            activeShort.segmentsToKeep\n          );\n          splitSegment(hit.item.index, sourceTime);\n        }\n        return;\n      }\n\n      // Select tool\n      const hit = hitTest(x, y);\n      if (hit) {\n        setSelectedItems([hit.item]);\n\n        if (hit.edge) {\n          // Start trimming\n          setDragState({\n            mode: \"trimming\",\n            item: hit.item,\n            edge: hit.edge,\n            startX: x,\n            startTime: time,\n          });\n        } else {\n          // Start dragging\n          setDragState({\n            mode: \"dragging\",\n            item: hit.item,\n            startX: x,\n            startTime: time,\n            originalValue: getItemTime(hit.item, activeShort),\n          });\n        }\n      } else {\n        // Click on empty space = seek\n        setSelectedItems([]);\n        setCursorTime(Math.max(0, Math.min(duration, time)));\n        setDragState({ mode: \"scrubbing\" });\n      }\n    },\n    [\n      activeShort,\n      zoom,\n      scrollX,\n      duration,\n      activeTool,\n      hitTest,\n      setCursorTime,\n      setSelectedItems,\n      splitSegment,\n    ]\n  );\n\n  const handleMouseMove = useCallback(\n    (e: MouseEvent<HTMLCanvasElement>) => {\n      if (!activeShort || !canvasRef.current) return;\n      const rect = canvasRef.current.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const time = pixelToTime(x - LABEL_WIDTH + scrollX, zoom, 0);\n\n      // Cursor style\n      const y = e.clientY - rect.top;\n      if (activeTool === \"cut\") {\n        canvasRef.current.style.cursor = \"crosshair\";\n      } else {\n        const hit = hitTest(x, y);\n        if (hit?.edge) {\n          canvasRef.current.style.cursor = \"col-resize\";\n        } else if (hit) {\n          canvasRef.current.style.cursor = \"grab\";\n        } else {\n          canvasRef.current.style.cursor = \"default\";\n        }\n      }\n\n      if (dragState.mode === \"scrubbing\") {\n        setCursorTime(Math.max(0, Math.min(duration, time)));\n      } else if (\n        dragState.mode === \"dragging\" &&\n        dragState.item &&\n        dragState.startTime !== undefined &&\n        dragState.originalValue !== undefined\n      ) {\n        const delta = time - dragState.startTime;\n        const newTime = Math.max(0, dragState.originalValue + delta);\n\n        if (dragState.item.type === \"overlay\") {\n          const concatTime = newTime;\n          const sourceTime = concatToSourceTime(\n            concatTime,\n            activeShort.segmentsToKeep\n          );\n          moveOverlay(dragState.item.index, sourceTime);\n        } else if (dragState.item.type === \"sfx\") {\n          const sourceTime = concatToSourceTime(\n            newTime,\n            activeShort.segmentsToKeep\n          );\n          moveSfx(dragState.item.index, sourceTime);\n        }\n      } else if (\n        dragState.mode === \"trimming\" &&\n        dragState.item &&\n        dragState.edge\n      ) {\n        if (dragState.item.type === \"segment\") {\n          const sourceTime = concatToSourceTime(\n            time,\n            activeShort.segmentsToKeep\n          );\n          trimSegment(dragState.item.index, dragState.edge, sourceTime);\n        } else if (dragState.item.type === \"overlay\") {\n          const ov = activeShort.overlays[dragState.item.index];\n          const concatStart = sourceToConcatTime(\n            ov.startAt,\n            activeShort.segmentsToKeep\n          );\n          if (concatStart === null) return;\n\n          if (dragState.edge === \"left\") {\n            const newConcatStart = Math.max(0, time);\n            const newDuration = concatStart + ov.duration - newConcatStart;\n            const newSourceStart = concatToSourceTime(\n              newConcatStart,\n              activeShort.segmentsToKeep\n            );\n            resizeOverlay(dragState.item.index, newSourceStart, newDuration);\n          } else {\n            const newDuration = Math.max(0.5, time - concatStart);\n            resizeOverlay(dragState.item.index, ov.startAt, newDuration);\n          }\n        }\n      }\n    },\n    [\n      activeShort,\n      zoom,\n      scrollX,\n      duration,\n      activeTool,\n      dragState,\n      hitTest,\n      setCursorTime,\n      moveOverlay,\n      moveSfx,\n      trimSegment,\n      resizeOverlay,\n    ]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setDragState({ mode: \"idle\" });\n  }, []);\n\n  // Wheel: zoom/scroll\n  const handleWheel = useCallback(\n    (e: React.WheelEvent) => {\n      if (e.ctrlKey || e.metaKey) {\n        e.preventDefault();\n        const delta = e.deltaY > 0 ? 0.9 : 1.1;\n        setZoom(zoom * delta);\n      } else {\n        setScrollX(scrollX + e.deltaX + e.deltaY);\n      }\n    },\n    [zoom, scrollX, setZoom, setScrollX]\n  );\n\n  // Keyboard\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      if (\n        e.target instanceof HTMLInputElement ||\n        e.target instanceof HTMLTextAreaElement\n      )\n        return;\n\n      switch (e.key) {\n        case \"Delete\":\n        case \"Backspace\":\n          if (selectedItems.length > 0) {\n            e.preventDefault();\n            const item = selectedItems[0];\n            if (item.type === \"segment\") deleteSegment(item.index);\n            else if (item.type === \"overlay\") deleteOverlay(item.index);\n            else if (item.type === \"sfx\") deleteSfx(item.index);\n          }\n          break;\n        case \" \":\n          e.preventDefault();\n          useEditorStore.getState().togglePlay();\n          break;\n        case \"v\":\n        case \"V\":\n          useEditorStore.getState().setActiveTool(\"select\");\n          break;\n        case \"c\":\n        case \"C\":\n          if (!e.ctrlKey && !e.metaKey) {\n            useEditorStore.getState().setActiveTool(\"cut\");\n          }\n          break;\n        case \"ArrowLeft\":\n          e.preventDefault();\n          setCursorTime(\n            Math.max(0, cursorTime - (e.shiftKey ? 1 : 1 / 30))\n          );\n          break;\n        case \"ArrowRight\":\n          e.preventDefault();\n          setCursorTime(\n            Math.min(duration, cursorTime + (e.shiftKey ? 1 : 1 / 30))\n          );\n          break;\n        case \"s\":\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            useEditorStore.getState().saveEdits();\n          }\n          break;\n        case \"z\":\n          if (e.ctrlKey || e.metaKey) {\n            e.preventDefault();\n            if (e.shiftKey) {\n              useEditorStore.temporal.getState().redo();\n            } else {\n              useEditorStore.temporal.getState().undo();\n            }\n          }\n          break;\n      }\n    };\n\n    window.addEventListener(\"keydown\", handler);\n    return () => window.removeEventListener(\"keydown\", handler);\n  }, [\n    selectedItems,\n    cursorTime,\n    duration,\n    setCursorTime,\n    deleteSegment,\n    deleteOverlay,\n    deleteSfx,\n  ]);\n\n  // Drop handler for assets\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      if (!activeShort) return;\n\n      try {\n        const data = JSON.parse(e.dataTransfer.getData(\"application/json\"));\n        const rect = canvasRef.current!.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        const concatTime = pixelToTime(x - LABEL_WIDTH + scrollX, zoom, 0);\n        const sourceTime = concatToSourceTime(\n          concatTime,\n          activeShort.segmentsToKeep\n        );\n\n        if (data.type === \"broll\" || data.type === \"graph\") {\n          useEditorStore.getState().addOverlay({\n            type: data.type,\n            matchLabel: data.label,\n            filePath: data.path,\n            startAt: sourceTime,\n            duration: 5, // default 5 seconds\n          });\n        } else if (data.type === \"sfx\") {\n          useEditorStore.getState().addSfx({\n            matchLabel: data.label,\n            filePath: data.path,\n            at: sourceTime,\n          });\n        }\n      } catch {\n        // Invalid drop data\n      }\n    },\n    [activeShort, zoom, scrollX]\n  );\n\n  if (!activeShort) {\n    return (\n      <div\n        ref={containerRef}\n        className=\"flex items-center justify-center h-full\"\n        style={{ background: \"#0f0f17\", color: \"var(--text-muted)\" }}\n      >\n        <span className=\"text-sm\">Select a short to view the timeline</span>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"w-full overflow-hidden relative\"\n      style={{ background: \"#0f0f17\" }}\n    >\n      <canvas\n        ref={canvasRef}\n        width={canvasSize.width}\n        height={canvasSize.height}\n        style={{\n          width: canvasSize.width,\n          height: canvasSize.height,\n          display: \"block\",\n        }}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n        onWheel={handleWheel}\n        onDragOver={(e) => e.preventDefault()}\n        onDrop={handleDrop}\n      />\n    </div>\n  );\n}\n\n// Helpers\n\nfunction getTickInterval(zoom: number): number {\n  const targetPixels = 80;\n  const rawInterval = targetPixels / zoom;\n\n  const intervals = [0.1, 0.25, 0.5, 1, 2, 5, 10, 15, 30, 60, 120, 300];\n  for (const interval of intervals) {\n    if (interval >= rawInterval) return interval;\n  }\n  return 600;\n}\n\nfunction getItemTime(\n  item: SelectedItem,\n  short: ShortEdit\n): number {\n  if (item.type === \"overlay\") {\n    const ov = short.overlays[item.index];\n    const ct = sourceToConcatTime(ov.startAt, short.segmentsToKeep);\n    return ct ?? 0;\n  }\n  if (item.type === \"sfx\") {\n    const sfx = short.sfx[item.index];\n    const ct = sourceToConcatTime(sfx.at, short.segmentsToKeep);\n    return ct ?? 0;\n  }\n  return 0;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2828, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/panels/AssetBrowser.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useEditorStore } from \"@/lib/store\";\n\ntype Tab = \"broll\" | \"graphs\" | \"sfx\";\n\nexport default function AssetBrowser() {\n  const assets = useEditorStore((s) => s.assets);\n  const [activeTab, setActiveTab] = useState<Tab>(\"broll\");\n\n  if (!assets) {\n    return (\n      <div\n        className=\"p-4 text-center text-sm\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        No assets loaded\n      </div>\n    );\n  }\n\n  const tabs: { key: Tab; label: string; count: number; color: string }[] = [\n    {\n      key: \"broll\",\n      label: \"B-Roll\",\n      count: assets.broll.length,\n      color: \"var(--broll)\",\n    },\n    {\n      key: \"graphs\",\n      label: \"Graphs\",\n      count: assets.graphs.length,\n      color: \"var(--graph)\",\n    },\n    {\n      key: \"sfx\",\n      label: \"SFX\",\n      count: assets.sfx.length,\n      color: \"var(--sfx)\",\n    },\n  ];\n\n  const items = assets[activeTab];\n\n  const handleDragStart = (\n    e: React.DragEvent,\n    item: { label: string; path: string }\n  ) => {\n    const type =\n      activeTab === \"broll\"\n        ? \"broll\"\n        : activeTab === \"graphs\"\n          ? \"graph\"\n          : \"sfx\";\n\n    e.dataTransfer.setData(\n      \"application/json\",\n      JSON.stringify({ type, label: item.label, path: item.path })\n    );\n    e.dataTransfer.effectAllowed = \"copy\";\n  };\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div\n        className=\"text-xs font-semibold uppercase tracking-wider px-3 py-2\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        Assets\n      </div>\n\n      {/* Tabs */}\n      <div\n        className=\"flex border-b\"\n        style={{ borderColor: \"var(--border)\" }}\n      >\n        {tabs.map((tab) => (\n          <button\n            key={tab.key}\n            onClick={() => setActiveTab(tab.key)}\n            className=\"flex-1 py-1.5 text-xs font-medium transition-colors\"\n            style={{\n              color:\n                activeTab === tab.key\n                  ? tab.color\n                  : \"var(--text-muted)\",\n              borderBottom:\n                activeTab === tab.key\n                  ? `2px solid ${tab.color}`\n                  : \"2px solid transparent\",\n            }}\n          >\n            {tab.label} ({tab.count})\n          </button>\n        ))}\n      </div>\n\n      {/* Asset list */}\n      <div className=\"flex-1 overflow-y-auto p-2\">\n        {items.length === 0 ? (\n          <div\n            className=\"text-xs text-center py-4\"\n            style={{ color: \"var(--text-muted)\" }}\n          >\n            No {activeTab} assets\n          </div>\n        ) : (\n          <div className=\"flex flex-col gap-1\">\n            {items.map((item, i) => (\n              <div\n                key={i}\n                draggable\n                onDragStart={(e) => handleDragStart(e, item)}\n                className=\"flex items-center gap-2 px-2 py-2 rounded-md cursor-grab active:cursor-grabbing transition-colors\"\n                style={{\n                  background: \"var(--bg-tertiary)\",\n                  border: \"1px solid var(--border)\",\n                }}\n              >\n                <div\n                  className=\"w-2 h-2 rounded-full flex-shrink-0\"\n                  style={{\n                    background:\n                      activeTab === \"broll\"\n                        ? \"var(--broll)\"\n                        : activeTab === \"graphs\"\n                          ? \"var(--graph)\"\n                          : \"var(--sfx)\",\n                  }}\n                />\n                <span\n                  className=\"text-xs truncate\"\n                  style={{ color: \"var(--text-primary)\" }}\n                >\n                  {item.label}\n                </span>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div\n        className=\"px-3 py-2 text-xs\"\n        style={{\n          color: \"var(--text-muted)\",\n          borderTop: \"1px solid var(--border)\",\n        }}\n      >\n        Drag assets onto the timeline\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAOe,SAAS;;IACtB,MAAM,SAAS,IAAA,wIAAc;+CAAC,CAAC,IAAM,EAAE,MAAM;;IAC7C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gLAAQ,EAAM;IAEhD,IAAI,CAAC,QAAQ;QACX,qBACE,oMAAC;YACC,WAAU;YACV,OAAO;gBAAE,OAAO;YAAoB;sBACrC;;;;;;IAIL;IAEA,MAAM,OAAoE;QACxE;YACE,KAAK;YACL,OAAO;YACP,OAAO,OAAO,KAAK,CAAC,MAAM;YAC1B,OAAO;QACT;QACA;YACE,KAAK;YACL,OAAO;YACP,OAAO,OAAO,MAAM,CAAC,MAAM;YAC3B,OAAO;QACT;QACA;YACE,KAAK;YACL,OAAO;YACP,OAAO,OAAO,GAAG,CAAC,MAAM;YACxB,OAAO;QACT;KACD;IAED,MAAM,QAAQ,MAAM,CAAC,UAAU;IAE/B,MAAM,kBAAkB,CACtB,GACA;QAEA,MAAM,OACJ,cAAc,UACV,UACA,cAAc,WACZ,UACA;QAER,EAAE,YAAY,CAAC,OAAO,CACpB,oBACA,KAAK,SAAS,CAAC;YAAE;YAAM,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC;QAE5D,EAAE,YAAY,CAAC,aAAa,GAAG;IACjC;IAEA,qBACE,oMAAC;QAAI,WAAU;;0BACb,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,OAAO;gBAAoB;0BACrC;;;;;;0BAKD,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,aAAa;gBAAgB;0BAErC,KAAK,GAAG,CAAC,CAAC,oBACT,oMAAC;wBAEC,SAAS,IAAM,aAAa,IAAI,GAAG;wBACnC,WAAU;wBACV,OAAO;4BACL,OACE,cAAc,IAAI,GAAG,GACjB,IAAI,KAAK,GACT;4BACN,cACE,cAAc,IAAI,GAAG,GACjB,AAAC,aAAsB,OAAV,IAAI,KAAK,IACtB;wBACR;;4BAEC,IAAI,KAAK;4BAAC;4BAAG,IAAI,KAAK;4BAAC;;uBAdnB,IAAI,GAAG;;;;;;;;;;0BAoBlB,oMAAC;gBAAI,WAAU;0BACZ,MAAM,MAAM,KAAK,kBAChB,oMAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO;oBAAoB;;wBACrC;wBACK;wBAAU;;;;;;yCAGhB,oMAAC;oBAAI,WAAU;8BACZ,MAAM,GAAG,CAAC,CAAC,MAAM,kBAChB,oMAAC;4BAEC,SAAS;4BACT,aAAa,CAAC,IAAM,gBAAgB,GAAG;4BACvC,WAAU;4BACV,OAAO;gCACL,YAAY;gCACZ,QAAQ;4BACV;;8CAEA,oMAAC;oCACC,WAAU;oCACV,OAAO;wCACL,YACE,cAAc,UACV,iBACA,cAAc,WACZ,iBACA;oCACV;;;;;;8CAEF,oMAAC;oCACC,WAAU;oCACV,OAAO;wCAAE,OAAO;oCAAsB;8CAErC,KAAK,KAAK;;;;;;;2BAxBR;;;;;;;;;;;;;;;0BAgCf,oMAAC;gBACC,WAAU;gBACV,OAAO;oBACL,OAAO;oBACP,WAAW;gBACb;0BACD;;;;;;;;;;;;AAKP;GAnJwB;;QACP,wIAAc;;;KADP","debugId":null}},
    {"offset": {"line": 3029, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/panels/PropertiesPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEditorStore } from \"@/lib/store\";\nimport { formatTime, sourceToConcatTime } from \"@/lib/timeline-utils\";\n\nexport default function PropertiesPanel() {\n  const shorts = useEditorStore((s) => s.shorts);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n  const selectedItems = useEditorStore((s) => s.selectedItems);\n\n  const activeShort = shorts.find((s) => s.id === activeShortId);\n\n  if (!activeShort || selectedItems.length === 0) {\n    return (\n      <div className=\"p-3\">\n        <div\n          className=\"text-xs font-semibold uppercase tracking-wider mb-2\"\n          style={{ color: \"var(--text-muted)\" }}\n        >\n          Properties\n        </div>\n        <div\n          className=\"text-xs\"\n          style={{ color: \"var(--text-muted)\" }}\n        >\n          Select an item on the timeline\n        </div>\n      </div>\n    );\n  }\n\n  const item = selectedItems[0];\n\n  if (item.type === \"segment\") {\n    const seg = activeShort.segmentsToKeep[item.index];\n    if (!seg) return null;\n    return (\n      <div className=\"p-3\">\n        <div\n          className=\"text-xs font-semibold uppercase tracking-wider mb-2\"\n          style={{ color: \"var(--text-muted)\" }}\n        >\n          A-Roll Segment\n        </div>\n        <PropRow label=\"Index\" value={`${item.index + 1} of ${activeShort.segmentsToKeep.length}`} />\n        <PropRow label=\"Source Start\" value={formatTime(seg.start)} />\n        <PropRow label=\"Source End\" value={formatTime(seg.end)} />\n        <PropRow label=\"Duration\" value={`${(seg.end - seg.start).toFixed(2)}s`} />\n      </div>\n    );\n  }\n\n  if (item.type === \"overlay\") {\n    const ov = activeShort.overlays[item.index];\n    if (!ov) return null;\n    const concatStart = sourceToConcatTime(ov.startAt, activeShort.segmentsToKeep);\n    return (\n      <div className=\"p-3\">\n        <div\n          className=\"text-xs font-semibold uppercase tracking-wider mb-2\"\n          style={{ color: \"var(--text-muted)\" }}\n        >\n          {ov.type === \"broll\" ? \"B-Roll\" : \"Graph\"} Overlay\n        </div>\n        <PropRow label=\"Label\" value={ov.matchLabel} />\n        <PropRow label=\"Source At\" value={formatTime(ov.startAt)} />\n        <PropRow label=\"Timeline At\" value={concatStart !== null ? formatTime(concatStart) : \"—\"} />\n        <PropRow label=\"Duration\" value={`${ov.duration.toFixed(2)}s`} />\n        {ov.filePath && <PropRow label=\"File\" value={ov.filePath.split(\"/\").pop() || \"\"} />}\n      </div>\n    );\n  }\n\n  if (item.type === \"sfx\") {\n    const sfx = activeShort.sfx[item.index];\n    if (!sfx) return null;\n    return (\n      <div className=\"p-3\">\n        <div\n          className=\"text-xs font-semibold uppercase tracking-wider mb-2\"\n          style={{ color: \"var(--text-muted)\" }}\n        >\n          Sound Effect\n        </div>\n        <PropRow label=\"Label\" value={sfx.matchLabel} />\n        <PropRow label=\"Source At\" value={formatTime(sfx.at)} />\n      </div>\n    );\n  }\n\n  return null;\n}\n\nfunction PropRow({ label, value }: { label: string; value: string }) {\n  return (\n    <div className=\"flex items-center justify-between py-1\">\n      <span\n        className=\"text-xs\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        {label}\n      </span>\n      <span\n        className=\"text-xs font-mono\"\n        style={{ color: \"var(--text-secondary)\" }}\n      >\n        {value}\n      </span>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACtB,MAAM,SAAS,IAAA,wIAAc;kDAAC,CAAC,IAAM,EAAE,MAAM;;IAC7C,MAAM,gBAAgB,IAAA,wIAAc;yDAAC,CAAC,IAAM,EAAE,aAAa;;IAC3D,MAAM,gBAAgB,IAAA,wIAAc;yDAAC,CAAC,IAAM,EAAE,aAAa;;IAE3D,MAAM,cAAc,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAEhD,IAAI,CAAC,eAAe,cAAc,MAAM,KAAK,GAAG;QAC9C,qBACE,oMAAC;YAAI,WAAU;;8BACb,oMAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO;oBAAoB;8BACrC;;;;;;8BAGD,oMAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO;oBAAoB;8BACrC;;;;;;;;;;;;IAKP;IAEA,MAAM,OAAO,aAAa,CAAC,EAAE;IAE7B,IAAI,KAAK,IAAI,KAAK,WAAW;QAC3B,MAAM,MAAM,YAAY,cAAc,CAAC,KAAK,KAAK,CAAC;QAClD,IAAI,CAAC,KAAK,OAAO;QACjB,qBACE,oMAAC;YAAI,WAAU;;8BACb,oMAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO;oBAAoB;8BACrC;;;;;;8BAGD,oMAAC;oBAAQ,OAAM;oBAAQ,OAAO,AAAC,GAAuB,OAArB,KAAK,KAAK,GAAG,GAAE,QAAwC,OAAlC,YAAY,cAAc,CAAC,MAAM;;;;;;8BACvF,oMAAC;oBAAQ,OAAM;oBAAe,OAAO,IAAA,gJAAU,EAAC,IAAI,KAAK;;;;;;8BACzD,oMAAC;oBAAQ,OAAM;oBAAa,OAAO,IAAA,gJAAU,EAAC,IAAI,GAAG;;;;;;8BACrD,oMAAC;oBAAQ,OAAM;oBAAW,OAAO,AAAC,GAAmC,OAAjC,CAAC,IAAI,GAAG,GAAG,IAAI,KAAK,EAAE,OAAO,CAAC,IAAG;;;;;;;;;;;;IAG3E;IAEA,IAAI,KAAK,IAAI,KAAK,WAAW;QAC3B,MAAM,KAAK,YAAY,QAAQ,CAAC,KAAK,KAAK,CAAC;QAC3C,IAAI,CAAC,IAAI,OAAO;QAChB,MAAM,cAAc,IAAA,wJAAkB,EAAC,GAAG,OAAO,EAAE,YAAY,cAAc;QAC7E,qBACE,oMAAC;YAAI,WAAU;;8BACb,oMAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO;oBAAoB;;wBAEnC,GAAG,IAAI,KAAK,UAAU,WAAW;wBAAQ;;;;;;;8BAE5C,oMAAC;oBAAQ,OAAM;oBAAQ,OAAO,GAAG,UAAU;;;;;;8BAC3C,oMAAC;oBAAQ,OAAM;oBAAY,OAAO,IAAA,gJAAU,EAAC,GAAG,OAAO;;;;;;8BACvD,oMAAC;oBAAQ,OAAM;oBAAc,OAAO,gBAAgB,OAAO,IAAA,gJAAU,EAAC,eAAe;;;;;;8BACrF,oMAAC;oBAAQ,OAAM;oBAAW,OAAO,AAAC,GAAyB,OAAvB,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAG;;;;;;gBAC1D,GAAG,QAAQ,kBAAI,oMAAC;oBAAQ,OAAM;oBAAO,OAAO,GAAG,QAAQ,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM;;;;;;;;;;;;IAGnF;IAEA,IAAI,KAAK,IAAI,KAAK,OAAO;QACvB,MAAM,MAAM,YAAY,GAAG,CAAC,KAAK,KAAK,CAAC;QACvC,IAAI,CAAC,KAAK,OAAO;QACjB,qBACE,oMAAC;YAAI,WAAU;;8BACb,oMAAC;oBACC,WAAU;oBACV,OAAO;wBAAE,OAAO;oBAAoB;8BACrC;;;;;;8BAGD,oMAAC;oBAAQ,OAAM;oBAAQ,OAAO,IAAI,UAAU;;;;;;8BAC5C,oMAAC;oBAAQ,OAAM;oBAAY,OAAO,IAAA,gJAAU,EAAC,IAAI,EAAE;;;;;;;;;;;;IAGzD;IAEA,OAAO;AACT;GAtFwB;;QACP,wIAAc;QACP,wIAAc;QACd,wIAAc;;;KAHd;AAwFxB,SAAS,QAAQ,KAAkD;QAAlD,EAAE,KAAK,EAAE,KAAK,EAAoC,GAAlD;IACf,qBACE,oMAAC;QAAI,WAAU;;0BACb,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,OAAO;gBAAoB;0BAEnC;;;;;;0BAEH,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,OAAO;gBAAwB;0BAEvC;;;;;;;;;;;;AAIT;MAjBS","debugId":null}},
    {"offset": {"line": 3306, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/components/panels/SubtitleEditor.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEditorStore } from \"@/lib/store\";\nimport { formatTime } from \"@/lib/timeline-utils\";\n\nexport default function SubtitleEditor() {\n  const shorts = useEditorStore((s) => s.shorts);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n  const selectedItems = useEditorStore((s) => s.selectedItems);\n  const updateSubtitleWord = useEditorStore((s) => s.updateSubtitleWord);\n\n  const activeShort = shorts.find((s) => s.id === activeShortId);\n  const subtitleSelection = selectedItems.find((s) => s.type === \"subtitle\");\n\n  if (!activeShort || !subtitleSelection) return null;\n\n  const WORDS_PER_GROUP = 5;\n  const startIdx = subtitleSelection.index;\n  const groupWords = activeShort.subtitleWords.slice(\n    startIdx,\n    startIdx + WORDS_PER_GROUP\n  );\n\n  return (\n    <div\n      className=\"border-t p-3\"\n      style={{\n        borderColor: \"var(--border)\",\n        background: \"var(--bg-secondary)\",\n      }}\n    >\n      <div\n        className=\"text-xs font-semibold uppercase tracking-wider mb-2\"\n        style={{ color: \"var(--text-muted)\" }}\n      >\n        Subtitle Editor\n      </div>\n\n      <div className=\"flex flex-col gap-1.5\">\n        {groupWords.map((word, i) => (\n          <div\n            key={startIdx + i}\n            className=\"flex items-center gap-2\"\n          >\n            <span\n              className=\"text-xs font-mono w-16 text-right flex-shrink-0\"\n              style={{ color: \"var(--text-muted)\" }}\n            >\n              {formatTime(word.start)}\n            </span>\n            <input\n              type=\"text\"\n              value={word.word}\n              onChange={(e) =>\n                updateSubtitleWord(startIdx + i, e.target.value)\n              }\n              className=\"flex-1 text-sm px-2 py-1 rounded\"\n              style={{\n                background: \"var(--bg-tertiary)\",\n                border: \"1px solid var(--border)\",\n                color: \"var(--text-primary)\",\n              }}\n            />\n            <span\n              className=\"text-xs font-mono w-16 flex-shrink-0\"\n              style={{ color: \"var(--text-muted)\" }}\n            >\n              {formatTime(word.end)}\n            </span>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACtB,MAAM,SAAS,IAAA,wIAAc;iDAAC,CAAC,IAAM,EAAE,MAAM;;IAC7C,MAAM,gBAAgB,IAAA,wIAAc;wDAAC,CAAC,IAAM,EAAE,aAAa;;IAC3D,MAAM,gBAAgB,IAAA,wIAAc;wDAAC,CAAC,IAAM,EAAE,aAAa;;IAC3D,MAAM,qBAAqB,IAAA,wIAAc;6DAAC,CAAC,IAAM,EAAE,kBAAkB;;IAErE,MAAM,cAAc,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAChD,MAAM,oBAAoB,cAAc,IAAI,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK;IAE/D,IAAI,CAAC,eAAe,CAAC,mBAAmB,OAAO;IAE/C,MAAM,kBAAkB;IACxB,MAAM,WAAW,kBAAkB,KAAK;IACxC,MAAM,aAAa,YAAY,aAAa,CAAC,KAAK,CAChD,UACA,WAAW;IAGb,qBACE,oMAAC;QACC,WAAU;QACV,OAAO;YACL,aAAa;YACb,YAAY;QACd;;0BAEA,oMAAC;gBACC,WAAU;gBACV,OAAO;oBAAE,OAAO;gBAAoB;0BACrC;;;;;;0BAID,oMAAC;gBAAI,WAAU;0BACZ,WAAW,GAAG,CAAC,CAAC,MAAM,kBACrB,oMAAC;wBAEC,WAAU;;0CAEV,oMAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,OAAO;gCAAoB;0CAEnC,IAAA,gJAAU,EAAC,KAAK,KAAK;;;;;;0CAExB,oMAAC;gCACC,MAAK;gCACL,OAAO,KAAK,IAAI;gCAChB,UAAU,CAAC,IACT,mBAAmB,WAAW,GAAG,EAAE,MAAM,CAAC,KAAK;gCAEjD,WAAU;gCACV,OAAO;oCACL,YAAY;oCACZ,QAAQ;oCACR,OAAO;gCACT;;;;;;0CAEF,oMAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,OAAO;gCAAoB;0CAEnC,IAAA,gJAAU,EAAC,KAAK,GAAG;;;;;;;uBA1BjB,WAAW;;;;;;;;;;;;;;;;AAiC5B;GArEwB;;QACP,wIAAc;QACP,wIAAc;QACd,wIAAc;QACT,wIAAc;;;KAJnB","debugId":null}},
    {"offset": {"line": 3434, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/app/editor/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useEditorStore } from \"@/lib/store\";\nimport RunPicker from \"@/components/panels/RunPicker\";\nimport ShortsList from \"@/components/panels/ShortsList\";\nimport PipelineControls from \"@/components/pipeline/PipelineControls\";\nimport VideoPlayer from \"@/components/editor/VideoPlayer\";\nimport Toolbar from \"@/components/editor/Toolbar\";\nimport Timeline from \"@/components/editor/Timeline\";\nimport AssetBrowser from \"@/components/panels/AssetBrowser\";\nimport PropertiesPanel from \"@/components/panels/PropertiesPanel\";\nimport SubtitleEditor from \"@/components/panels/SubtitleEditor\";\n\nexport default function EditorPage() {\n  const isDirty = useEditorStore((s) => s.isDirty);\n  const currentRunId = useEditorStore((s) => s.currentRunId);\n  const activeShortId = useEditorStore((s) => s.activeShortId);\n\n  // Warn on unsaved changes\n  useEffect(() => {\n    const handler = (e: BeforeUnloadEvent) => {\n      if (isDirty) {\n        e.preventDefault();\n      }\n    };\n    window.addEventListener(\"beforeunload\", handler);\n    return () => window.removeEventListener(\"beforeunload\", handler);\n  }, [isDirty]);\n\n  return (\n    <div\n      className=\"h-screen flex flex-col overflow-hidden\"\n      style={{ background: \"var(--bg-primary)\" }}\n    >\n      {/* Top bar */}\n      <header\n        className=\"flex items-center px-4 py-1.5 border-b flex-shrink-0\"\n        style={{\n          borderColor: \"var(--border)\",\n          background: \"var(--bg-secondary)\",\n        }}\n      >\n        <div className=\"flex items-center gap-2\">\n          <span\n            className=\"text-sm font-semibold\"\n            style={{ color: \"var(--text-primary)\" }}\n          >\n            Video Pipeline\n          </span>\n          <span\n            className=\"text-xs px-1.5 py-0.5 rounded\"\n            style={{\n              background: \"var(--accent-muted)\",\n              color: \"var(--accent)\",\n            }}\n          >\n            Editor\n          </span>\n        </div>\n        <div className=\"flex-1 mx-4 max-w-md\">\n          <RunPicker />\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {isDirty && (\n            <span\n              className=\"text-xs\"\n              style={{ color: \"var(--warning)\" }}\n            >\n              Unsaved changes\n            </span>\n          )}\n        </div>\n      </header>\n\n      {/* Main content */}\n      <div className=\"flex-1 flex overflow-hidden\">\n        {/* Left sidebar */}\n        <aside\n          className=\"flex-shrink-0 flex flex-col border-r overflow-y-auto\"\n          style={{\n            width: 240,\n            borderColor: \"var(--border)\",\n            background: \"var(--bg-secondary)\",\n          }}\n        >\n          <ShortsList />\n          <div\n            className=\"border-t mt-auto\"\n            style={{ borderColor: \"var(--border)\" }}\n          >\n            <PipelineControls />\n          </div>\n        </aside>\n\n        {/* Center: Video + Timeline */}\n        <main className=\"flex-1 flex flex-col min-w-0 overflow-hidden\">\n          {/* Video player */}\n          <div className=\"flex-1 min-h-0\">\n            <VideoPlayer />\n          </div>\n\n          {/* Toolbar */}\n          <Toolbar />\n\n          {/* Timeline */}\n          <div\n            className=\"flex-shrink-0 border-t\"\n            style={{\n              height: 240,\n              borderColor: \"var(--border)\",\n            }}\n          >\n            <Timeline />\n          </div>\n\n          {/* Subtitle editor (appears when subtitle selected) */}\n          <SubtitleEditor />\n        </main>\n\n        {/* Right sidebar */}\n        <aside\n          className=\"flex-shrink-0 flex flex-col border-l overflow-y-auto\"\n          style={{\n            width: 240,\n            borderColor: \"var(--border)\",\n            background: \"var(--bg-secondary)\",\n          }}\n        >\n          <div className=\"flex-1\">\n            <AssetBrowser />\n          </div>\n          <div\n            className=\"border-t\"\n            style={{ borderColor: \"var(--border)\" }}\n          >\n            <PropertiesPanel />\n          </div>\n        </aside>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAZA;;;;;;;;;;;;AAce,SAAS;;IACtB,MAAM,UAAU,IAAA,wIAAc;8CAAC,CAAC,IAAM,EAAE,OAAO;;IAC/C,MAAM,eAAe,IAAA,wIAAc;mDAAC,CAAC,IAAM,EAAE,YAAY;;IACzD,MAAM,gBAAgB,IAAA,wIAAc;oDAAC,CAAC,IAAM,EAAE,aAAa;;IAE3D,0BAA0B;IAC1B,IAAA,iLAAS;gCAAC;YACR,MAAM;gDAAU,CAAC;oBACf,IAAI,SAAS;wBACX,EAAE,cAAc;oBAClB;gBACF;;YACA,OAAO,gBAAgB,CAAC,gBAAgB;YACxC;wCAAO,IAAM,OAAO,mBAAmB,CAAC,gBAAgB;;QAC1D;+BAAG;QAAC;KAAQ;IAEZ,qBACE,oMAAC;QACC,WAAU;QACV,OAAO;YAAE,YAAY;QAAoB;;0BAGzC,oMAAC;gBACC,WAAU;gBACV,OAAO;oBACL,aAAa;oBACb,YAAY;gBACd;;kCAEA,oMAAC;wBAAI,WAAU;;0CACb,oMAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,OAAO;gCAAsB;0CACvC;;;;;;0CAGD,oMAAC;gCACC,WAAU;gCACV,OAAO;oCACL,YAAY;oCACZ,OAAO;gCACT;0CACD;;;;;;;;;;;;kCAIH,oMAAC;wBAAI,WAAU;kCACb,cAAA,oMAAC,uJAAS;;;;;;;;;;kCAEZ,oMAAC;wBAAI,WAAU;kCACZ,yBACC,oMAAC;4BACC,WAAU;4BACV,OAAO;gCAAE,OAAO;4BAAiB;sCAClC;;;;;;;;;;;;;;;;;0BAQP,oMAAC;gBAAI,WAAU;;kCAEb,oMAAC;wBACC,WAAU;wBACV,OAAO;4BACL,OAAO;4BACP,aAAa;4BACb,YAAY;wBACd;;0CAEA,oMAAC,wJAAU;;;;;0CACX,oMAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,aAAa;gCAAgB;0CAEtC,cAAA,oMAAC,gKAAgB;;;;;;;;;;;;;;;;kCAKrB,oMAAC;wBAAK,WAAU;;0CAEd,oMAAC;gCAAI,WAAU;0CACb,cAAA,oMAAC,yJAAW;;;;;;;;;;0CAId,oMAAC,qJAAO;;;;;0CAGR,oMAAC;gCACC,WAAU;gCACV,OAAO;oCACL,QAAQ;oCACR,aAAa;gCACf;0CAEA,cAAA,oMAAC,sJAAQ;;;;;;;;;;0CAIX,oMAAC,4JAAc;;;;;;;;;;;kCAIjB,oMAAC;wBACC,WAAU;wBACV,OAAO;4BACL,OAAO;4BACP,aAAa;4BACb,YAAY;wBACd;;0CAEA,oMAAC;gCAAI,WAAU;0CACb,cAAA,oMAAC,0JAAY;;;;;;;;;;0CAEf,oMAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,aAAa;gCAAgB;0CAEtC,cAAA,oMAAC,6JAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM5B;GAhIwB;;QACN,wIAAc;QACT,wIAAc;QACb,wIAAc;;;KAHd","debugId":null}}]
}