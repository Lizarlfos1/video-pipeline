(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{63:(e,t,l)=>{"use strict";var r=l(7260);l.o(r,"useRouter")&&l.d(t,{useRouter:function(){return r.useRouter}}),l.o(r,"useSearchParams")&&l.d(t,{useSearchParams:function(){return r.useSearchParams}})},490:(e,t,l)=>{"use strict";l.d(t,{y:()=>s});let r=e=>{let t,l=new Set,r=(e,r)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=r?r:"object"!=typeof s||null===s)?s:Object.assign({},t,s),l.forEach(l=>l(t,e))}},s=()=>t,a={setState:r,getState:s,getInitialState:()=>n,subscribe:e=>(l.add(e),()=>l.delete(e))},n=t=e(r,s,a);return a},s=e=>e?r(e):r},1138:(e,t,l)=>{"use strict";l.d(t,{v:()=>n});var r=l(2115),s=l(490);let a=e=>{let t=(0,s.y)(e),l=e=>(function(e,t=e=>e){let l=r.useSyncExternalStore(e.subscribe,r.useCallback(()=>t(e.getState()),[e,t]),r.useCallback(()=>t(e.getInitialState()),[e,t]));return r.useDebugValue(l),l})(t,e);return Object.assign(l,t),l},n=e=>e?a(e):a},4094:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>P});var r=l(5155),s=l(2115),a=l(63),n=l(1138),i=l(490),o=(e,t,l)=>(r,s)=>({pastStates:l?.pastStates||[],futureStates:l?.futureStates||[],undo:(a=1)=>{if(s().pastStates.length){let n=l?.partialize?.(t())||t(),i=s().pastStates.splice(-a,a),o=i.shift();e(o),r({pastStates:s().pastStates,futureStates:s().futureStates.concat(l?.diff?.(n,o)||n,i.reverse())})}},redo:(a=1)=>{if(s().futureStates.length){let n=l?.partialize?.(t())||t(),i=s().futureStates.splice(-a,a),o=i.shift();e(o),r({pastStates:s().pastStates.concat(l?.diff?.(n,o)||n,i.reverse()),futureStates:s().futureStates})}},clear:()=>r({pastStates:[],futureStates:[]}),isTracking:!0,pause:()=>r({isTracking:!1}),resume:()=>r({isTracking:!0}),setOnSave:e=>r({_onSave:e}),_onSave:l?.onSave,_handleSet:(e,t,a,n)=>{l?.limit&&s().pastStates.length>=l?.limit&&s().pastStates.shift(),s()._onSave?.(e,a),r({pastStates:s().pastStates.concat(n||e),futureStates:[]})}}),c=l(7621);function d(e,t){let l=0;for(let r of t){if(e>=r.start&&e<=r.end)return l+(e-r.start);l+=r.end-r.start}return null}function u(e,t){let l=e;for(let e of t){let t=e.end-e.start;if(l<=t)return e.start+l;l-=t}let r=t[t.length-1];return r?r.end:0}function x(e){return e.reduce((e,t)=>e+(t.end-t.start),0)}function f(e){let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toFixed(1).padStart(4,"0"))}function m(e){let t=Math.floor(e/60),l=Math.floor(e%60);return"".concat(t,":").concat(l.toString().padStart(2,"0"))}function p(e,t){if(null!==t)return e.find(e=>e.id===t)}let h=(0,n.v)()(((e,t)=>(l,r,s)=>{s.temporal=(0,i.y)(t?.wrapTemporal?.(o(l,r,t))||o(l,r,t));let a=t?.handleSet?.(s.temporal.getState()._handleSet)||s.temporal.getState()._handleSet,n=e=>{if(!s.temporal.getState().isTracking)return;let l=t?.partialize?.(r())||r(),n=t?.diff?.(e,l);null===n||t?.equality?.(e,l)||a(e,void 0,l,n)},c=s.setState;return s.setState=(...e)=>{let l=t?.partialize?.(r())||r();c(...e),n(l)},e((...e)=>{let s=t?.partialize?.(r())||r();l(...e),n(s)},r,s)})((e,t)=>({runs:[],currentRunId:null,transcript:null,assets:null,shorts:[],activeShortId:null,zoom:80,scrollX:0,cursorTime:0,isPlaying:!1,activeTool:"select",selectedItems:[],duration:0,pipelineStatus:{pull:"idle",transcribe:"idle",analyze:"idle",align:"idle",edit:"idle",subtitles:"idle"},pipelineLogs:[],activeJob:null,isDirty:!1,fetchRuns:async()=>{e({runs:await c.v()})},loadRun:async l=>{e({currentRunId:l,shorts:[],activeShortId:null});try{let[r,s,a]=await Promise.allSettled([c.H7(l),c.Y(l),c.u2(l)]);e({transcript:"fulfilled"===r.status?r.value:null,assets:"fulfilled"===s.status?s.value:null,shorts:"fulfilled"===a.status?a.value:[]});let n="fulfilled"===a.status?a.value:[];n.length>0&&t().selectShort(n[0].id)}catch(e){console.error("Failed to load run:",e)}},selectShort:l=>{let r=p(t().shorts,l);e({activeShortId:l,cursorTime:0,scrollX:0,selectedItems:[],duration:r?x(r.segmentsToKeep):0})},setZoom:t=>e({zoom:Math.max(10,Math.min(500,t))}),setScrollX:t=>e({scrollX:Math.max(0,t)}),setCursorTime:t=>e({cursorTime:Math.max(0,t)}),setIsPlaying:t=>e({isPlaying:t}),togglePlay:()=>e(e=>({isPlaying:!e.isPlaying})),setActiveTool:t=>e({activeTool:t}),setSelectedItems:t=>e({selectedItems:t}),clearSelection:()=>e({selectedItems:[]}),updateShort:(t,l)=>{e(e=>({shorts:e.shorts.map(e=>e.id===t?{...e,...l}:e),isDirty:!0}))},splitSegment:(e,l)=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);if(!a)return;let n=a.segmentsToKeep[e];if(!n||l<=n.start||l>=n.end)return;let i=[...a.segmentsToKeep];i.splice(e,1,{start:n.start,end:l},{start:l,end:n.end}),t().updateShort(a.id,{segmentsToKeep:i})},deleteSegment:l=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);if(!a||a.segmentsToKeep.length<=1)return;let n=a.segmentsToKeep.filter((e,t)=>t!==l);t().updateShort(a.id,{segmentsToKeep:n}),e({duration:x(n),selectedItems:[]})},moveOverlay:(e,l)=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);if(!a)return;let n=[...a.overlays];n[e]={...n[e],startAt:l},t().updateShort(a.id,{overlays:n})},resizeOverlay:(e,l,r)=>{let{activeShortId:s,shorts:a}=t(),n=p(a,s);if(!n)return;let i=[...n.overlays];i[e]={...i[e],startAt:l,duration:Math.max(.5,r)},t().updateShort(n.id,{overlays:i})},addOverlay:e=>{let{activeShortId:l,shorts:r}=t(),s=p(r,l);s&&t().updateShort(s.id,{overlays:[...s.overlays,e]})},deleteOverlay:l=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);a&&(t().updateShort(a.id,{overlays:a.overlays.filter((e,t)=>t!==l)}),e({selectedItems:[]}))},moveSfx:(e,l)=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);if(!a)return;let n=[...a.sfx];n[e]={...n[e],at:l},t().updateShort(a.id,{sfx:n})},addSfx:e=>{let{activeShortId:l,shorts:r}=t(),s=p(r,l);s&&t().updateShort(s.id,{sfx:[...s.sfx,e]})},deleteSfx:l=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);a&&(t().updateShort(a.id,{sfx:a.sfx.filter((e,t)=>t!==l)}),e({selectedItems:[]}))},trimSegment:(l,r,s)=>{let{activeShortId:a,shorts:n}=t(),i=p(n,a);if(!i)return;let o=i.segmentsToKeep[l];if(!o)return;let c=[...i.segmentsToKeep];"left"===r?c[l]={start:Math.min(s,o.end-.1),end:o.end}:c[l]={start:o.start,end:Math.max(s,o.start+.1)},t().updateShort(i.id,{segmentsToKeep:c}),e({duration:x(c)})},updateSubtitleWord:(e,l)=>{let{activeShortId:r,shorts:s}=t(),a=p(s,r);if(!a)return;let n=[...a.subtitleWords];n[e]={...n[e],word:l},t().updateShort(a.id,{subtitleWords:n})},saveEdits:async()=>{let{currentRunId:l,shorts:r}=t();l&&(await c.bH(l,r),e({isDirty:!1}))},triggerStage:async function(l){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{currentRunId:s,activeShortId:a}=t();if(s){e(e=>({pipelineStatus:{...e.pipelineStatus,[l]:"running"},pipelineLogs:[]}));try{let n={runId:s,...r};("edit"===l||"subtitles"===l)&&null!==a&&(n.shortId=a);let{jobId:i}=await c.jn(l,n);e({activeJob:{stage:l,jobId:i}});let o=new EventSource(c.S0(l,i));o.onmessage=r=>{try{let a=JSON.parse(r.data);"log"===a.type?e(e=>({pipelineLogs:[...e.pipelineLogs,a.data]})):"done"===a.type?(e(e=>({pipelineStatus:{...e.pipelineStatus,[l]:"success"},activeJob:null})),o.close(),"analyze"===l&&t().loadRun(s)):"error"===a.type&&(e(e=>({pipelineStatus:{...e.pipelineStatus,[l]:"error"},activeJob:null})),o.close())}catch(t){e(e=>({pipelineLogs:[...e.pipelineLogs,r.data]}))}},o.onerror=()=>{e(e=>({pipelineStatus:{...e.pipelineStatus,[l]:"error"},activeJob:null})),o.close()}}catch(t){console.error("Pipeline trigger failed:",t),e(e=>({pipelineStatus:{...e.pipelineStatus,[l]:"error"},activeJob:null}))}}}}),{partialize:e=>({shorts:e.shorts}),limit:50}));function v(){let e=h(e=>e.runs),t=h(e=>e.currentRunId),l=h(e=>e.fetchRuns),a=h(e=>e.loadRun);return(0,s.useEffect)(()=>{l()},[l]),(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-b",style:{borderColor:"var(--border)"},children:[(0,r.jsx)("label",{className:"text-xs font-medium",style:{color:"var(--text-secondary)"},children:"Run"}),(0,r.jsxs)("select",{value:t||"",onChange:e=>e.target.value&&a(e.target.value),className:"flex-1 text-sm",style:{background:"var(--bg-tertiary)",border:"1px solid var(--border)",color:"var(--text-primary)",borderRadius:6,padding:"4px 8px"},children:[(0,r.jsx)("option",{value:"",children:"Select a run..."}),e.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.id,e.hasEdits?" (".concat(e.shortsCount," shorts)"):"",e.hasARoll?"":" [no video]"]},e.id))]}),(0,r.jsx)("button",{onClick:()=>l(),className:"text-xs px-2 py-1 rounded",style:{background:"var(--bg-tertiary)",color:"var(--text-secondary)",border:"1px solid var(--border)"},children:"Refresh"})]})}function g(){let e=h(e=>e.shorts),t=h(e=>e.activeShortId),l=h(e=>e.selectShort);return 0===e.length?(0,r.jsx)("div",{className:"p-4 text-center text-sm",style:{color:"var(--text-muted)"},children:"No shorts found. Run the Analyze stage to generate edits."}):(0,r.jsxs)("div",{className:"flex flex-col gap-1 p-2 overflow-y-auto",style:{maxHeight:"calc(100vh - 400px)"},children:[(0,r.jsxs)("div",{className:"text-xs font-semibold uppercase tracking-wider px-2 py-1",style:{color:"var(--text-muted)"},children:["Shorts (",e.length,")"]}),e.map(e=>{let s=x(e.segmentsToKeep),a=e.id===t;return(0,r.jsxs)("button",{onClick:()=>l(e.id),className:"w-full text-left rounded-lg px-3 py-2.5 transition-colors",style:{background:a?"var(--accent-muted)":"transparent",border:a?"1px solid var(--accent)":"1px solid transparent"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-xs font-mono",style:{color:a?"var(--accent)":"var(--text-muted)"},children:["#",e.id]}),(0,r.jsx)("span",{className:"text-xs font-mono",style:{color:"var(--text-muted)"},children:m(s)})]}),(0,r.jsx)("div",{className:"text-sm mt-0.5 truncate",style:{color:a?"var(--text-primary)":"var(--text-secondary)"},children:e.title}),(0,r.jsxs)("div",{className:"flex gap-2 mt-1 text-xs",style:{color:"var(--text-muted)"},children:[(0,r.jsxs)("span",{children:[e.segmentsToKeep.length," segs"]}),e.overlays.length>0&&(0,r.jsxs)("span",{style:{color:"var(--broll)"},children:[e.overlays.length," overlays"]}),e.sfx.length>0&&(0,r.jsxs)("span",{style:{color:"var(--sfx)"},children:[e.sfx.length," sfx"]})]})]},e.id)})]})}let y=[{key:"pull",label:"Pull",description:"Download video & assets from Drive"},{key:"transcribe",label:"Transcribe",description:"Transcribe audio with Whisper"},{key:"analyze",label:"Auto Edit",description:"AI generates shorts from transcript"},{key:"edit",label:"Render",description:"FFmpeg renders the short video"},{key:"subtitles",label:"Subtitles",description:"Add animated captions"}],b={idle:{icon:"○",color:"var(--text-muted)"},running:{icon:"◎",color:"var(--accent)"},success:{icon:"●",color:"var(--success)"},error:{icon:"●",color:"var(--error)"}};function S(){let e=h(e=>e.currentRunId),t=h(e=>e.pipelineStatus),l=h(e=>e.pipelineLogs);h(e=>e.activeJob);let a=h(e=>e.triggerStage),[n,i]=(0,s.useState)(!1),[o,c]=(0,s.useState)(""),d=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;null==(e=d.current)||e.scrollIntoView({behavior:"smooth"})},[l]),(0,r.jsxs)("div",{className:"flex flex-col gap-1 p-2",children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider px-2 py-1",style:{color:"var(--text-muted)"},children:"Pipeline"}),y.map(l=>{let{key:s,label:n,description:d}=l,u=t[s],{icon:x,color:f}=b[u],m="running"===u,p=m||!e&&"pull"!==s;return(0,r.jsxs)("div",{children:["pull"===s&&(0,r.jsx)("input",{type:"text",placeholder:"Drive ID or local path...",value:o,onChange:e=>c(e.target.value),className:"w-full text-xs mb-1 px-2 py-1.5 rounded",style:{background:"var(--bg-tertiary)",border:"1px solid var(--border)",color:"var(--text-primary)"}}),(0,r.jsxs)("button",{onClick:()=>{let e={};"pull"===s&&o&&(e.source=o),a(s,e),i(!0)},disabled:p,className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left transition-all",style:{background:m?"var(--accent-muted)":"var(--bg-tertiary)",border:"1px solid var(--border)",opacity:p&&!m?.5:1,cursor:p?"not-allowed":"pointer"},children:[(0,r.jsx)("span",{style:{color:f,fontSize:14},className:m?"animate-pulse":"",children:x}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"text-sm font-medium",style:{color:m?"var(--accent)":"var(--text-primary)"},children:n}),(0,r.jsx)("div",{className:"text-xs truncate",style:{color:"var(--text-muted)"},children:d})]})]})]},s)}),n&&l.length>0&&(0,r.jsxs)("div",{className:"mt-2 rounded-lg overflow-hidden",style:{background:"var(--bg-primary)",border:"1px solid var(--border)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 py-1",style:{borderBottom:"1px solid var(--border)"},children:[(0,r.jsx)("span",{className:"text-xs font-medium",style:{color:"var(--text-muted)"},children:"Logs"}),(0,r.jsx)("button",{onClick:()=>i(!1),className:"text-xs px-1",style:{color:"var(--text-muted)"},children:"\xd7"})]}),(0,r.jsxs)("div",{className:"p-2 overflow-y-auto font-mono text-xs leading-relaxed",style:{maxHeight:160,color:"var(--text-secondary)",whiteSpace:"pre-wrap",wordBreak:"break-all"},children:[l.map((e,t)=>(0,r.jsx)("div",{children:e},t)),(0,r.jsx)("div",{ref:d})]})]})]})}function j(){var e;let t=(0,s.useRef)(null),l=(0,s.useRef)(0),a=h(e=>e.currentRunId),n=h(e=>e.shorts),i=h(e=>e.activeShortId),o=h(e=>e.isPlaying),x=h(e=>e.cursorTime),m=h(e=>e.duration),p=h(e=>e.setCursorTime),v=h(e=>e.setIsPlaying),g=n.find(e=>e.id===i),y=null!=(e=null==g?void 0:g.segmentsToKeep)?e:[],b=a?(0,c.SG)("runs/".concat(a,"/a-roll.mp4")):"";(0,s.useEffect)(()=>{if(!t.current||0===y.length)return;let e=u(x,y);Math.abs(t.current.currentTime-e)>.1&&(t.current.currentTime=e)},[x,y]);let S=(0,s.useCallback)(()=>{if(!t.current||0===y.length)return;let e=t.current.currentTime,r=y.findIndex(t=>e>=t.start-.05&&e<=t.end+.05);if(-1===r){let l=y.find(t=>t.start>e);if(l)t.current.currentTime=l.start;else{t.current.pause(),v(!1);return}}else if(e>=y[r].end-.03)if(r<y.length-1)t.current.currentTime=y[r+1].start;else{t.current.pause(),v(!1);return}let s=d(t.current.currentTime,y);null!==s&&p(s),l.current=requestAnimationFrame(S)},[y,p,v]);(0,s.useEffect)(()=>{if(t.current){if(o){let e=u(x,y);t.current.currentTime=e,t.current.play().catch(()=>v(!1)),l.current=requestAnimationFrame(S)}else t.current.pause(),cancelAnimationFrame(l.current);return()=>cancelAnimationFrame(l.current)}},[o]);let j=(0,s.useCallback)(e=>{p(Math.max(0,Math.min(m,x+1/30*e)))},[x,m,p]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",style:{background:"var(--bg-primary)"},children:[(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-hidden relative",children:b?(0,r.jsx)("video",{ref:t,src:b,className:"max-h-full max-w-full object-contain",style:{borderRadius:4},preload:"auto"}):(0,r.jsx)("div",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Select a run to load video"})}),(0,r.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 border-t",style:{borderColor:"var(--border)",background:"var(--bg-secondary)"},children:[(0,r.jsx)("button",{onClick:()=>j(-1),className:"p-1.5 rounded hover:opacity-80",style:{color:"var(--text-secondary)"},title:"Previous frame (←)",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M6 6h2v12H6zm3.5 6 8.5 6V6z"})})}),(0,r.jsx)("button",{onClick:()=>h.getState().togglePlay(),className:"p-2 rounded-full",style:{background:"var(--accent)",color:"#fff"},title:"Play/Pause (Space)",children:o?(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M6 4h4v16H6zM14 4h4v16h-4z"})}):(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,r.jsx)("button",{onClick:()=>j(1),className:"p-1.5 rounded hover:opacity-80",style:{color:"var(--text-secondary)"},title:"Next frame (→)",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})})}),(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsxs)("span",{className:"font-mono text-sm tabular-nums",style:{color:"var(--text-secondary)"},children:[f(x)," / ",f(m)]})]})]})}function k(){let e=h(e=>e.activeTool),t=h(e=>e.setActiveTool),l=h(e=>e.zoom),s=h(e=>e.setZoom),a=h(e=>e.cursorTime),n=h(e=>e.duration),i=h(e=>e.isDirty),o=h(e=>e.saveEdits),c=h(e=>e.triggerStage),d=h(e=>e.activeShortId);return(0,r.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 border-t",style:{borderColor:"var(--border)",background:"var(--bg-secondary)"},children:[(0,r.jsx)("div",{className:"flex gap-1",children:[{key:"select",label:"Select",shortcut:"V",icon:"↖"},{key:"cut",label:"Cut",shortcut:"C",icon:"✂"},{key:"trim",label:"Trim",shortcut:"T",icon:"⇔"}].map(l=>(0,r.jsxs)("button",{onClick:()=>t(l.key),className:"flex items-center gap-1 px-2.5 py-1 rounded text-sm transition-colors",title:"".concat(l.label," (").concat(l.shortcut,")"),style:{background:e===l.key?"var(--accent-muted)":"transparent",color:e===l.key?"var(--accent)":"var(--text-secondary)",border:e===l.key?"1px solid var(--accent)":"1px solid transparent"},children:[(0,r.jsx)("span",{children:l.icon}),(0,r.jsx)("span",{className:"text-xs",children:l.label})]},l.key))}),(0,r.jsx)("div",{className:"w-px h-5 mx-1",style:{background:"var(--border)"}}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("button",{onClick:()=>s(.8*l),className:"px-1.5 py-0.5 rounded text-xs",style:{color:"var(--text-secondary)",background:"var(--bg-tertiary)"},children:"−"}),(0,r.jsx)("input",{type:"range",min:10,max:500,value:l,onChange:e=>s(Number(e.target.value)),className:"w-20 h-1 accent-indigo-500",style:{accentColor:"var(--accent)"}}),(0,r.jsx)("button",{onClick:()=>s(1.2*l),className:"px-1.5 py-0.5 rounded text-xs",style:{color:"var(--text-secondary)",background:"var(--bg-tertiary)"},children:"+"}),(0,r.jsxs)("span",{className:"text-xs font-mono w-12",style:{color:"var(--text-muted)"},children:[Math.round(l),"px/s"]})]}),(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsxs)("span",{className:"font-mono text-sm tabular-nums",style:{color:"var(--text-secondary)"},children:[f(a)," / ",f(n)]}),(0,r.jsx)("div",{className:"w-px h-5 mx-1",style:{background:"var(--border)"}}),(0,r.jsx)("button",{onClick:()=>h.temporal.getState().undo(),className:"px-2 py-1 rounded text-xs",style:{color:"var(--text-secondary)",background:"var(--bg-tertiary)"},title:"Undo (Ctrl+Z)",children:"Undo"}),(0,r.jsx)("button",{onClick:()=>h.temporal.getState().redo(),className:"px-2 py-1 rounded text-xs",style:{color:"var(--text-secondary)",background:"var(--bg-tertiary)"},title:"Redo (Ctrl+Shift+Z)",children:"Redo"}),(0,r.jsx)("div",{className:"w-px h-5 mx-1",style:{background:"var(--border)"}}),(0,r.jsx)("button",{onClick:()=>o(),className:"px-3 py-1 rounded text-xs font-medium transition-colors",style:{background:i?"var(--accent)":"var(--bg-tertiary)",color:i?"#fff":"var(--text-secondary)"},title:"Save (Ctrl+S)",children:i?"Save*":"Saved"}),null!==d&&(0,r.jsx)("button",{onClick:async()=>{await o(),await c("edit")},className:"px-3 py-1 rounded text-xs font-medium",style:{background:"var(--bg-tertiary)",color:"var(--text-secondary)",border:"1px solid var(--border)"},title:"Re-render current short",children:"Re-render"})]})}let N=[{id:"aroll",type:"aroll",label:"A-Roll",height:72,color:"#3b82f6"},{id:"overlay",type:"overlay",label:"Overlays",height:56,color:"#6366f1"},{id:"subtitle",type:"subtitle",label:"Subtitles",height:44,color:"#a855f7"},{id:"sfx",type:"sfx",label:"SFX",height:36,color:"#f59e0b"}];function T(){let e=(0,s.useRef)(null),t=(0,s.useRef)(null),[l,a]=(0,s.useState)({mode:"idle"}),[n,i]=(0,s.useState)({width:0,height:0}),o=h(e=>e.shorts),c=h(e=>e.activeShortId),x=h(e=>e.zoom),f=h(e=>e.scrollX),p=h(e=>e.cursorTime),v=h(e=>e.duration),g=h(e=>e.activeTool),y=h(e=>e.selectedItems),b=h(e=>e.setCursorTime),S=h(e=>e.setZoom),j=h(e=>e.setScrollX),k=h(e=>e.setSelectedItems),T=h(e=>e.splitSegment),w=h(e=>e.moveOverlay),C=h(e=>e.resizeOverlay),R=h(e=>e.moveSfx),M=h(e=>e.trimSegment),K=h(e=>e.deleteSegment),P=h(e=>e.deleteOverlay),A=h(e=>e.deleteSfx),I=o.find(e=>e.id===c),E=28+N.reduce((e,t)=>e+t.height+2,0)+8;(0,s.useEffect)(()=>{let e=t.current;if(!e)return;let l=new ResizeObserver(e=>{let{width:t}=e[0].contentRect;i({width:t,height:E})});return l.observe(e),()=>l.disconnect()},[E]);let D=(0,s.useCallback)(e=>{let t=28;for(let l=0;l<e;l++)t+=N[l].height+2;return t},[]),z=(0,s.useCallback)(e=>{let t=28;for(let l=0;l<N.length;l++){if(e>=t&&e<t+N[l].height)return l;t+=N[l].height+2}return -1},[]),L=(0,s.useCallback)(()=>{let t=e.current;if(!t||!I)return;let r=t.getContext("2d");if(!r)return;let s=window.devicePixelRatio||1;t.width=n.width*s,t.height=n.height*s,r.scale(s,s);let a=n.width,i=n.height;r.fillStyle="#0f0f17",r.fillRect(0,0,a,i);let o=e=>e*x-f+72;r.fillStyle="#151520",r.fillRect(0,0,a,28),r.strokeStyle="#2a2a3a",r.lineWidth=1,r.beginPath(),r.moveTo(0,28),r.lineTo(a,28),r.stroke();let c=function(e){let t=80/e;for(let e of[.1,.25,.5,1,2,5,10,15,30,60,120,300])if(e>=t)return e;return 600}(x),u=Math.floor((-72+f+0)/x/c)*c,h=(a-72+f+0)/x;r.font="10px -apple-system, sans-serif",r.fillStyle="#606078",r.textAlign="center";for(let e=u;e<=h;e+=c){if(e<0)continue;let t=o(e);if(t<72||t>a)continue;r.strokeStyle="#2a2a3a",r.beginPath(),r.moveTo(t,20),r.lineTo(t,28),r.stroke(),r.fillText(m(e),t,16);let l=c/4;for(let t=e+l;t<e+c;t+=l){let e=o(t);e<72||e>a||(r.strokeStyle="#1e1e2a",r.beginPath(),r.moveTo(e,24),r.lineTo(e,28),r.stroke())}}N.forEach((e,t)=>{let l=D(t);r.fillStyle="#12121a",r.fillRect(0,l,72,e.height),r.strokeStyle="#2a2a3a",r.strokeRect(0,l,72,e.height),r.fillStyle="#9090a8",r.font="11px -apple-system, sans-serif",r.textAlign="left",r.fillText(e.label,8,l+e.height/2+4)}),N.forEach((e,t)=>{let l=D(t);r.fillStyle="#0d0d15",r.fillRect(72,l,a-72,e.height)});let v=D(0),b=N[0].height,S=0;I.segmentsToKeep.forEach((e,t)=>{let l=e.end-e.start,s=o(S),n=l*x,i=y.some(e=>"segment"===e.type&&e.index===t);if(s+n>72&&s<a){let t=Math.max(72,s),l=Math.min(s+n,a)-t;if(r.fillStyle=i?"rgba(59, 130, 246, 0.45)":"rgba(59, 130, 246, 0.25)",r.fillRect(t,v+2,l,b-4),r.strokeStyle=i?"#60a5fa":"#3b82f6",r.lineWidth=i?2:1,r.strokeRect(t,v+2,l,b-4),n>40){r.fillStyle="#93bbfc",r.font="10px -apple-system, sans-serif",r.textAlign="left";let l=Math.max(t+6,78);r.fillText("".concat(m(e.start),"–").concat(m(e.end)),l,v+16)}i&&(r.fillStyle="#60a5fa",r.fillRect(t,v+2,4,b-4),r.fillRect(t+l-4,v+2,4,b-4))}t>0&&(r.strokeStyle="rgba(59, 130, 246, 0.4)",r.setLineDash([3,3]),r.beginPath(),r.moveTo(s,v),r.lineTo(s,v+b),r.stroke(),r.setLineDash([])),S+=l});let j=D(1),k=N[1].height;I.overlays.forEach((e,t)=>{let l=d(e.startAt,I.segmentsToKeep);if(null===l)return;let s=o(l),n=e.duration*x,i=y.some(e=>"overlay"===e.type&&e.index===t);if(s+n>72&&s<a){let t=Math.max(72,s),l=Math.min(s+n,a)-t,o="broll"===e.type?"rgba(99, 102, 241, 0.35)":"rgba(34, 197, 94, 0.35)",c="broll"===e.type?"#818cf8":"#4ade80";if(r.fillStyle=i?"broll"===e.type?"rgba(99, 102, 241, 0.55)":"rgba(34, 197, 94, 0.55)":o,r.fillRect(t,j+2,l,k-4),r.strokeStyle=i?"#fff":c,r.lineWidth=i?2:1,r.strokeRect(t,j+2,l,k-4),n>30){r.fillStyle="#fff",r.font="10px -apple-system, sans-serif",r.textAlign="left";let l=Math.max(t+4,76);r.fillText(e.matchLabel,l,j+k/2+3)}i&&(r.fillStyle="#fff",r.fillRect(t,j+2,3,k-4),r.fillRect(t+l-3,j+2,3,k-4))}});let T=D(2),w=N[2].height;if(I.subtitleWords.length>0)for(let e=0;e<I.subtitleWords.length;e+=5){let t=I.subtitleWords.slice(e,e+5),l=t[0],s=t[t.length-1],n=d(l.start,I.segmentsToKeep),i=d(s.end,I.segmentsToKeep);if(null===n||null===i)continue;let c=o(n),u=(i-n)*x,f=y.some(t=>"subtitle"===t.type&&t.index===e);if(c+u>72&&c<a&&u>2){let e=Math.max(72,c),l=Math.min(c+u,a)-e;if(r.fillStyle=f?"rgba(168, 85, 247, 0.45)":"rgba(168, 85, 247, 0.2)",r.fillRect(e,T+2,l,w-4),r.strokeStyle=f?"#c084fc":"rgba(168, 85, 247, 0.4)",r.lineWidth=1,r.strokeRect(e,T+2,l,w-4),u>20){r.fillStyle="#d8b4fe",r.font="9px -apple-system, sans-serif",r.textAlign="left";let s=t.map(e=>e.word).join(" "),a=Math.max(e+3,75);r.fillText(s,a,T+w/2+3,l-6)}}}let C=D(3),R=N[3].height;I.sfx.forEach((e,t)=>{let l=d(e.at,I.segmentsToKeep);if(null===l)return;let s=o(l),n=y.some(e=>"sfx"===e.type&&e.index===t);s>72&&s<a&&(r.fillStyle=n?"rgba(245, 158, 11, 0.8)":"rgba(245, 158, 11, 0.5)",r.beginPath(),r.moveTo(s,C+R/2-8),r.lineTo(s+8,C+R/2),r.moveTo(s,C+R/2+8),r.lineTo(s-8,C+R/2),r.closePath(),r.fill(),r.strokeStyle=n?"rgba(245, 158, 11, 0.8)":"rgba(245, 158, 11, 0.3)",r.lineWidth=1,r.beginPath(),r.moveTo(s,C),r.lineTo(s,C+R),r.stroke(),r.fillStyle="#fbbf24",r.font="9px -apple-system, sans-serif",r.textAlign="left",r.fillText(e.matchLabel,s+6,C+12))}),I.emphasisWords.forEach(e=>{let t=d(e.timestamp,I.segmentsToKeep);if(null===t)return;let l=o(t);l<72||l>a||(r.fillStyle="#ffd700",r.beginPath(),r.moveTo(l-4,v+b-2),r.lineTo(l+4,v+b-2),r.lineTo(l,v+b-10),r.closePath(),r.fill())});let M=o(p);M>=72&&M<=a&&(r.strokeStyle="#ef4444",r.lineWidth=2,r.beginPath(),r.moveTo(M,0),r.lineTo(M,i),r.stroke(),r.fillStyle="#ef4444",r.beginPath(),r.moveTo(M-6,0),r.lineTo(M+6,0),r.lineTo(M,8),r.closePath(),r.fill()),"cut"===g&&l.mode},[n,I,x,f,p,y,g,v,D,l]);(0,s.useEffect)(()=>{let e=requestAnimationFrame(L);return()=>cancelAnimationFrame(e)},[L]);let O=(0,s.useCallback)((e,t)=>{if(!I)return null;let l=(e-72+f+0)/x,r=z(t);if(0===r){let e=0;for(let t=0;t<I.segmentsToKeep.length;t++){let r=I.segmentsToKeep[t],s=r.end-r.start;if(l>=e&&l<=e+s){let r=e,a=e+s,n=8/x;if(Math.abs(l-r)<n)return{item:{type:"segment",index:t},edge:"left"};if(Math.abs(l-a)<n)return{item:{type:"segment",index:t},edge:"right"};return{item:{type:"segment",index:t}}}e+=s}}else if(1===r)for(let e=0;e<I.overlays.length;e++){let t=I.overlays[e],r=d(t.startAt,I.segmentsToKeep);if(null!==r&&l>=r&&l<=r+t.duration){let s=8/x;if(Math.abs(l-r)<s)return{item:{type:"overlay",index:e},edge:"left"};if(Math.abs(l-(r+t.duration))<s)return{item:{type:"overlay",index:e},edge:"right"};return{item:{type:"overlay",index:e}}}}else if(2===r)for(let e=0;e<I.subtitleWords.length;e+=5){let t=I.subtitleWords.slice(e,e+5),r=t[0],s=t[t.length-1],a=d(r.start,I.segmentsToKeep),n=d(s.end,I.segmentsToKeep);if(null!==a&&null!==n&&l>=a&&l<=n)return{item:{type:"subtitle",index:e}}}else if(3===r)for(let e=0;e<I.sfx.length;e++){let t=d(I.sfx[e].at,I.segmentsToKeep);if(null!==t&&Math.abs(l-t)<12/x)return{item:{type:"sfx",index:e}}}return null},[I,x,f,z]),W=(0,s.useCallback)(t=>{if(!I)return;let l=e.current.getBoundingClientRect(),r=t.clientX-l.left,s=t.clientY-l.top,n=(r-72+f+0)/x;if(s<28){b(Math.max(0,Math.min(v,n))),a({mode:"scrubbing"});return}if("cut"===g){let e=O(r,s);if(e&&"segment"===e.item.type){let t=u(n,I.segmentsToKeep);T(e.item.index,t)}return}let i=O(r,s);i?(k([i.item]),i.edge?a({mode:"trimming",item:i.item,edge:i.edge,startX:r,startTime:n}):a({mode:"dragging",item:i.item,startX:r,startTime:n,originalValue:function(e,t){if("overlay"===e.type){let l=d(t.overlays[e.index].startAt,t.segmentsToKeep);return null!=l?l:0}if("sfx"===e.type){let l=d(t.sfx[e.index].at,t.segmentsToKeep);return null!=l?l:0}return 0}(i.item,I)})):(k([]),b(Math.max(0,Math.min(v,n))),a({mode:"scrubbing"}))},[I,x,f,v,g,O,b,k,T]),F=(0,s.useCallback)(t=>{if(!I||!e.current)return;let r=e.current.getBoundingClientRect(),s=t.clientX-r.left,a=(s-72+f+0)/x,n=t.clientY-r.top;if("cut"===g)e.current.style.cursor="crosshair";else{let t=O(s,n);(null==t?void 0:t.edge)?e.current.style.cursor="col-resize":t?e.current.style.cursor="grab":e.current.style.cursor="default"}if("scrubbing"===l.mode)b(Math.max(0,Math.min(v,a)));else if("dragging"===l.mode&&l.item&&void 0!==l.startTime&&void 0!==l.originalValue){let e=a-l.startTime,t=Math.max(0,l.originalValue+e);if("overlay"===l.item.type){let e=u(t,I.segmentsToKeep);w(l.item.index,e)}else if("sfx"===l.item.type){let e=u(t,I.segmentsToKeep);R(l.item.index,e)}}else if("trimming"===l.mode&&l.item&&l.edge){if("segment"===l.item.type){let e=u(a,I.segmentsToKeep);M(l.item.index,l.edge,e)}else if("overlay"===l.item.type){let e=I.overlays[l.item.index],t=d(e.startAt,I.segmentsToKeep);if(null===t)return;if("left"===l.edge){let r=Math.max(0,a),s=t+e.duration-r,n=u(r,I.segmentsToKeep);C(l.item.index,n,s)}else{let r=Math.max(.5,a-t);C(l.item.index,e.startAt,r)}}}},[I,x,f,v,g,l,O,b,w,R,M,C]),X=(0,s.useCallback)(()=>{a({mode:"idle"})},[]),B=(0,s.useCallback)(e=>{e.ctrlKey||e.metaKey?(e.preventDefault(),S(x*(e.deltaY>0?.9:1.1))):j(f+e.deltaX+e.deltaY)},[x,f,S,j]);(0,s.useEffect)(()=>{let e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"Delete":case"Backspace":if(y.length>0){e.preventDefault();let t=y[0];"segment"===t.type?K(t.index):"overlay"===t.type?P(t.index):"sfx"===t.type&&A(t.index)}break;case" ":e.preventDefault(),h.getState().togglePlay();break;case"v":case"V":h.getState().setActiveTool("select");break;case"c":case"C":e.ctrlKey||e.metaKey||h.getState().setActiveTool("cut");break;case"ArrowLeft":e.preventDefault(),b(Math.max(0,p-(e.shiftKey?1:1/30)));break;case"ArrowRight":e.preventDefault(),b(Math.min(v,p+(e.shiftKey?1:1/30)));break;case"s":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),h.getState().saveEdits());break;case"z":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.shiftKey?h.temporal.getState().redo():h.temporal.getState().undo())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y,p,v,b,K,P,A]);let J=(0,s.useCallback)(t=>{if(t.preventDefault(),I)try{var l;let r=JSON.parse(t.dataTransfer.getData("application/json")),s=e.current.getBoundingClientRect(),a=(l=t.clientX-s.left-72+f,(l+0)/x),n=u(a,I.segmentsToKeep);"broll"===r.type||"graph"===r.type?h.getState().addOverlay({type:r.type,matchLabel:r.label,filePath:r.path,startAt:n,duration:5}):"sfx"===r.type&&h.getState().addSfx({matchLabel:r.label,filePath:r.path,at:n})}catch(e){}},[I,x,f]);return I?(0,r.jsx)("div",{ref:t,className:"w-full overflow-hidden relative",style:{background:"#0f0f17"},children:(0,r.jsx)("canvas",{ref:e,width:n.width,height:n.height,style:{width:n.width,height:n.height,display:"block"},onMouseDown:W,onMouseMove:F,onMouseUp:X,onMouseLeave:X,onWheel:B,onDragOver:e=>e.preventDefault(),onDrop:J})}):(0,r.jsx)("div",{ref:t,className:"flex items-center justify-center h-full",style:{background:"#0f0f17",color:"var(--text-muted)"},children:(0,r.jsx)("span",{className:"text-sm",children:"Select a short to view the timeline"})})}function w(){let e=h(e=>e.assets),[t,l]=(0,s.useState)("broll");if(!e)return(0,r.jsx)("div",{className:"p-4 text-center text-sm",style:{color:"var(--text-muted)"},children:"No assets loaded"});let a=[{key:"broll",label:"B-Roll",count:e.broll.length,color:"var(--broll)"},{key:"graphs",label:"Graphs",count:e.graphs.length,color:"var(--graph)"},{key:"sfx",label:"SFX",count:e.sfx.length,color:"var(--sfx)"}],n=e[t];return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider px-3 py-2",style:{color:"var(--text-muted)"},children:"Assets"}),(0,r.jsx)("div",{className:"flex border-b",style:{borderColor:"var(--border)"},children:a.map(e=>(0,r.jsxs)("button",{onClick:()=>l(e.key),className:"flex-1 py-1.5 text-xs font-medium transition-colors",style:{color:t===e.key?e.color:"var(--text-muted)",borderBottom:t===e.key?"2px solid ".concat(e.color):"2px solid transparent"},children:[e.label," (",e.count,")"]},e.key))}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-2",children:0===n.length?(0,r.jsxs)("div",{className:"text-xs text-center py-4",style:{color:"var(--text-muted)"},children:["No ",t," assets"]}):(0,r.jsx)("div",{className:"flex flex-col gap-1",children:n.map((e,l)=>(0,r.jsxs)("div",{draggable:!0,onDragStart:l=>((e,l)=>{let r="broll"===t?"broll":"graphs"===t?"graph":"sfx";e.dataTransfer.setData("application/json",JSON.stringify({type:r,label:l.label,path:l.path})),e.dataTransfer.effectAllowed="copy"})(l,e),className:"flex items-center gap-2 px-2 py-2 rounded-md cursor-grab active:cursor-grabbing transition-colors",style:{background:"var(--bg-tertiary)",border:"1px solid var(--border)"},children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:"broll"===t?"var(--broll)":"graphs"===t?"var(--graph)":"var(--sfx)"}}),(0,r.jsx)("span",{className:"text-xs truncate",style:{color:"var(--text-primary)"},children:e.label})]},l))})}),(0,r.jsx)("div",{className:"px-3 py-2 text-xs",style:{color:"var(--text-muted)",borderTop:"1px solid var(--border)"},children:"Drag assets onto the timeline"})]})}function C(){let e=h(e=>e.shorts),t=h(e=>e.activeShortId),l=h(e=>e.selectedItems),s=e.find(e=>e.id===t);if(!s||0===l.length)return(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"var(--text-muted)"},children:"Properties"}),(0,r.jsx)("div",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Select an item on the timeline"})]});let a=l[0];if("segment"===a.type){let e=s.segmentsToKeep[a.index];return e?(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"var(--text-muted)"},children:"A-Roll Segment"}),(0,r.jsx)(R,{label:"Index",value:"".concat(a.index+1," of ").concat(s.segmentsToKeep.length)}),(0,r.jsx)(R,{label:"Source Start",value:f(e.start)}),(0,r.jsx)(R,{label:"Source End",value:f(e.end)}),(0,r.jsx)(R,{label:"Duration",value:"".concat((e.end-e.start).toFixed(2),"s")})]}):null}if("overlay"===a.type){let e=s.overlays[a.index];if(!e)return null;let t=d(e.startAt,s.segmentsToKeep);return(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"var(--text-muted)"},children:["broll"===e.type?"B-Roll":"Graph"," Overlay"]}),(0,r.jsx)(R,{label:"Label",value:e.matchLabel}),(0,r.jsx)(R,{label:"Source At",value:f(e.startAt)}),(0,r.jsx)(R,{label:"Timeline At",value:null!==t?f(t):"—"}),(0,r.jsx)(R,{label:"Duration",value:"".concat(e.duration.toFixed(2),"s")}),e.filePath&&(0,r.jsx)(R,{label:"File",value:e.filePath.split("/").pop()||""})]})}if("sfx"===a.type){let e=s.sfx[a.index];return e?(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"var(--text-muted)"},children:"Sound Effect"}),(0,r.jsx)(R,{label:"Label",value:e.matchLabel}),(0,r.jsx)(R,{label:"Source At",value:f(e.at)})]}):null}return null}function R(e){let{label:t,value:l}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-between py-1",children:[(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:t}),(0,r.jsx)("span",{className:"text-xs font-mono",style:{color:"var(--text-secondary)"},children:l})]})}function M(){let e=h(e=>e.shorts),t=h(e=>e.activeShortId),l=h(e=>e.selectedItems),s=h(e=>e.updateSubtitleWord),a=e.find(e=>e.id===t),n=l.find(e=>"subtitle"===e.type);if(!a||!n)return null;let i=n.index,o=a.subtitleWords.slice(i,i+5);return(0,r.jsxs)("div",{className:"border-t p-3",style:{borderColor:"var(--border)",background:"var(--bg-secondary)"},children:[(0,r.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2",style:{color:"var(--text-muted)"},children:"Subtitle Editor"}),(0,r.jsx)("div",{className:"flex flex-col gap-1.5",children:o.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs font-mono w-16 text-right flex-shrink-0",style:{color:"var(--text-muted)"},children:f(e.start)}),(0,r.jsx)("input",{type:"text",value:e.word,onChange:e=>s(i+t,e.target.value),className:"flex-1 text-sm px-2 py-1 rounded",style:{background:"var(--bg-tertiary)",border:"1px solid var(--border)",color:"var(--text-primary)"}}),(0,r.jsx)("span",{className:"text-xs font-mono w-16 flex-shrink-0",style:{color:"var(--text-muted)"},children:f(e.end)})]},i+t))})]})}function K(){let e=(0,a.useSearchParams)(),t=h(e=>e.currentRunId),l=h(e=>e.loadRun),r=h(e=>e.selectShort);return(0,s.useEffect)(()=>{let s=e.get("run"),a=e.get("short");s&&s!==t&&l(s).then(()=>{a&&r(parseInt(a,10))})},[e,t,l,r]),null}function P(){let e=h(e=>e.isDirty);return(0,s.useEffect)(()=>{let t=t=>{e&&t.preventDefault()};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e]),(0,r.jsxs)("div",{className:"h-screen flex flex-col overflow-hidden",style:{background:"var(--bg-primary)"},children:[(0,r.jsx)(s.Suspense,{fallback:null,children:(0,r.jsx)(K,{})}),(0,r.jsxs)("header",{className:"flex items-center px-4 py-1.5 border-b flex-shrink-0",style:{borderColor:"var(--border)",background:"var(--bg-secondary)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm font-semibold",style:{color:"var(--text-primary)"},children:"Video Pipeline"}),(0,r.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:"var(--accent-muted)",color:"var(--accent)"},children:"Editor"})]}),(0,r.jsx)("div",{className:"flex-1 mx-4 max-w-md",children:(0,r.jsx)(v,{})}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:e&&(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--warning)"},children:"Unsaved changes"})})]}),(0,r.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,r.jsxs)("aside",{className:"flex-shrink-0 flex flex-col border-r overflow-y-auto",style:{width:240,borderColor:"var(--border)",background:"var(--bg-secondary)"},children:[(0,r.jsx)(g,{}),(0,r.jsx)("div",{className:"border-t mt-auto",style:{borderColor:"var(--border)"},children:(0,r.jsx)(S,{})})]}),(0,r.jsxs)("main",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[(0,r.jsx)("div",{className:"flex-1 min-h-0",children:(0,r.jsx)(j,{})}),(0,r.jsx)(k,{}),(0,r.jsx)("div",{className:"flex-shrink-0 border-t",style:{height:240,borderColor:"var(--border)"},children:(0,r.jsx)(T,{})}),(0,r.jsx)(M,{})]}),(0,r.jsxs)("aside",{className:"flex-shrink-0 flex flex-col border-l overflow-y-auto",style:{width:240,borderColor:"var(--border)",background:"var(--bg-secondary)"},children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(w,{})}),(0,r.jsx)("div",{className:"border-t",style:{borderColor:"var(--border)"},children:(0,r.jsx)(C,{})})]})]})]})}},7621:(e,t,l)=>{"use strict";l.d(t,{H7:()=>n,S0:()=>f,SG:()=>u,Y:()=>i,bH:()=>c,jn:()=>x,tt:()=>d,u2:()=>o,v:()=>a});let r="/api";async function s(e,t){let l=await fetch(e,t);if(!l.ok){let e=await l.text();throw Error("".concat(l.status,": ").concat(e))}return l.json()}async function a(){return s("".concat(r,"/runs"))}async function n(e){return s("".concat(r,"/runs/").concat(e,"/transcript"))}async function i(e){return s("".concat(r,"/runs/").concat(e,"/assets"))}async function o(e){return s("".concat(r,"/runs/").concat(e,"/edits"))}async function c(e,t){await s("".concat(r,"/runs/").concat(e,"/edits"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async function d(e,t){let l=new FormData;l.append("video",e),l.append("script",t);let s=await fetch("".concat(r,"/upload"),{method:"POST",body:l});if(!s.ok){let e=await s.text();throw Error("Upload failed: ".concat(s.status,": ").concat(e))}return s.json()}function u(e){return"".concat(r,"/media?path=").concat(encodeURIComponent(e))}async function x(e,t){return s("".concat(r,"/pipeline/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}function f(e,t){return"".concat(r,"/pipeline/").concat(e,"/stream?jobId=").concat(t)}},9052:(e,t,l)=>{Promise.resolve().then(l.bind(l,4094))}},e=>{e.O(0,[441,255,358],()=>e(e.s=9052)),_N_E=e.O()}]);