{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/lib/paths.ts"],"sourcesContent":["import path from \"node:path\";\n\n/** Project root is one level up from /web */\nexport const PROJECT_ROOT = path.resolve(process.cwd(), \"..\");\nexport const RUNS_DIR = path.join(PROJECT_ROOT, \"runs\");\nexport const ASSETS_DIR = path.join(PROJECT_ROOT, \"assets\");\n\n/** Validate a path is within the project root (prevent directory traversal) */\nexport function validatePath(relativePath: string): string | null {\n  const absolute = path.resolve(PROJECT_ROOT, relativePath);\n  if (!absolute.startsWith(PROJECT_ROOT)) return null;\n  return absolute;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAGO,MAAM,eAAe,4HAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;AACjD,MAAM,WAAW,4HAAI,CAAC,IAAI,CAAC,cAAc;AACzC,MAAM,aAAa,4HAAI,CAAC,IAAI,CAAC,cAAc;AAG3C,SAAS,aAAa,YAAoB;IAC/C,MAAM,WAAW,4HAAI,CAAC,OAAO,CAAC,cAAc;IAC5C,IAAI,CAAC,SAAS,UAAU,CAAC,eAAe,OAAO;IAC/C,OAAO;AACT","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/lib/jobs.ts"],"sourcesContent":["import type { ChildProcess } from \"node:child_process\";\n\n/** In-memory job store for pipeline processes (single-user local tool) */\n\ninterface Job {\n  process: ChildProcess;\n  logs: string[];\n  status: \"running\" | \"done\" | \"error\";\n  listeners: Set<(data: string) => void>;\n}\n\nconst jobs = new Map<string, Job>();\n\nexport function getJob(jobId: string): Job | undefined {\n  return jobs.get(jobId);\n}\n\nexport function createJob(jobId: string, process: ChildProcess): Job {\n  const job: Job = {\n    process,\n    logs: [],\n    status: \"running\",\n    listeners: new Set(),\n  };\n  jobs.set(jobId, job);\n\n  process.stdout?.on(\"data\", (data: Buffer) => {\n    const line = data.toString();\n    job.logs.push(line);\n    for (const fn of job.listeners) {\n      fn(JSON.stringify({ type: \"log\", data: line }));\n    }\n  });\n\n  process.stderr?.on(\"data\", (data: Buffer) => {\n    const line = data.toString();\n    job.logs.push(line);\n    for (const fn of job.listeners) {\n      fn(JSON.stringify({ type: \"log\", data: line }));\n    }\n  });\n\n  process.on(\"close\", (code) => {\n    job.status = code === 0 ? \"done\" : \"error\";\n    for (const fn of job.listeners) {\n      fn(JSON.stringify({ type: job.status }));\n    }\n  });\n\n  return job;\n}\n\nexport function addListener(\n  jobId: string,\n  fn: (data: string) => void\n): () => void {\n  const job = jobs.get(jobId);\n  if (!job) return () => {};\n  job.listeners.add(fn);\n  return () => job.listeners.delete(fn);\n}\n"],"names":[],"mappings":";;;;;;;;AAWA,MAAM,OAAO,IAAI;AAEV,SAAS,OAAO,KAAa;IAClC,OAAO,KAAK,GAAG,CAAC;AAClB;AAEO,SAAS,UAAU,KAAa,EAAE,OAAqB;IAC5D,MAAM,MAAW;QACf;QACA,MAAM,EAAE;QACR,QAAQ;QACR,WAAW,IAAI;IACjB;IACA,KAAK,GAAG,CAAC,OAAO;IAEhB,QAAQ,MAAM,EAAE,GAAG,QAAQ,CAAC;QAC1B,MAAM,OAAO,KAAK,QAAQ;QAC1B,IAAI,IAAI,CAAC,IAAI,CAAC;QACd,KAAK,MAAM,MAAM,IAAI,SAAS,CAAE;YAC9B,GAAG,KAAK,SAAS,CAAC;gBAAE,MAAM;gBAAO,MAAM;YAAK;QAC9C;IACF;IAEA,QAAQ,MAAM,EAAE,GAAG,QAAQ,CAAC;QAC1B,MAAM,OAAO,KAAK,QAAQ;QAC1B,IAAI,IAAI,CAAC,IAAI,CAAC;QACd,KAAK,MAAM,MAAM,IAAI,SAAS,CAAE;YAC9B,GAAG,KAAK,SAAS,CAAC;gBAAE,MAAM;gBAAO,MAAM;YAAK;QAC9C;IACF;IAEA,QAAQ,EAAE,CAAC,SAAS,CAAC;QACnB,IAAI,MAAM,GAAG,SAAS,IAAI,SAAS;QACnC,KAAK,MAAM,MAAM,IAAI,SAAS,CAAE;YAC9B,GAAG,KAAK,SAAS,CAAC;gBAAE,MAAM,IAAI,MAAM;YAAC;QACvC;IACF;IAEA,OAAO;AACT;AAEO,SAAS,YACd,KAAa,EACb,EAA0B;IAE1B,MAAM,MAAM,KAAK,GAAG,CAAC;IACrB,IAAI,CAAC,KAAK,OAAO,KAAO;IACxB,IAAI,SAAS,CAAC,GAAG,CAAC;IAClB,OAAO,IAAM,IAAI,SAAS,CAAC,MAAM,CAAC;AACpC","debugId":null}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///Users/jimmygrills/Documents/Coding/video-pipeline/web/app/api/pipeline/%5Bstage%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { spawn } from \"node:child_process\";\nimport { randomUUID } from \"node:crypto\";\nimport path from \"node:path\";\nimport { PROJECT_ROOT } from \"@/lib/paths\";\nimport { createJob } from \"@/lib/jobs\";\n\nconst VALID_STAGES = new Set([\n  \"pull\",\n  \"transcribe\",\n  \"analyze\",\n  \"align\",\n  \"edit\",\n  \"subtitles\",\n]);\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ stage: string }> }\n) {\n  const { stage } = await params;\n\n  if (!VALID_STAGES.has(stage)) {\n    return NextResponse.json({ error: \"Invalid stage\" }, { status: 400 });\n  }\n\n  const body = await request.json();\n  const jobId = randomUUID();\n\n  // Build CLI args\n  const args = [\"--env-file=.env\", \"src/cli.ts\", stage];\n  if (body.runId) args.push(\"--run-dir\", path.join(\"runs\", body.runId));\n  if (body.shortId != null) args.push(\"--short\", String(body.shortId));\n  if (body.source) args.push(body.source);\n\n  const child = spawn(\"npx\", [\"tsx\", ...args], {\n    cwd: PROJECT_ROOT,\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    shell: true,\n  });\n\n  createJob(jobId, child);\n\n  return NextResponse.json({ jobId });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,MAAM,eAAe,IAAI,IAAI;IAC3B;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,eAAe,KACpB,OAAoB,EACpB,EAAE,MAAM,EAA0C;IAElD,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM;IAExB,IAAI,CAAC,aAAa,GAAG,CAAC,QAAQ;QAC5B,OAAO,uJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrE;IAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;IAC/B,MAAM,QAAQ,IAAA,mIAAU;IAExB,iBAAiB;IACjB,MAAM,OAAO;QAAC;QAAmB;QAAc;KAAM;IACrD,IAAI,KAAK,KAAK,EAAE,KAAK,IAAI,CAAC,aAAa,4HAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,KAAK;IACnE,IAAI,KAAK,OAAO,IAAI,MAAM,KAAK,IAAI,CAAC,WAAW,OAAO,KAAK,OAAO;IAClE,IAAI,KAAK,MAAM,EAAE,KAAK,IAAI,CAAC,KAAK,MAAM;IAEtC,MAAM,QAAQ,IAAA,4IAAK,EAAC,OAAO;QAAC;WAAU;KAAK,EAAE;QAC3C,KAAK,qIAAY;QACjB,OAAO;YAAC;YAAU;YAAQ;SAAO;QACjC,OAAO;IACT;IAEA,IAAA,iIAAS,EAAC,OAAO;IAEjB,OAAO,uJAAY,CAAC,IAAI,CAAC;QAAE;IAAM;AACnC","debugId":null}}]
}